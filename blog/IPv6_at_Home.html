<!DOCTYPE html><html lang="en"><head><title>IPv6 at Home - Raymii.org</title><link href="/s/inc/css/light.css" rel="stylesheet" title="light"/><link href="/s/inc/css/dark.css" rel="alternate stylesheet" title="dark"/><script src="/s/inc/js/jquery-2.1.1.min.js"></script><script src="/s/inc/js/bootstrap.3.2.0.min.js"></script><script src="/s/inc/js/styleswitcher.js"></script><meta content="text/html;charset=utf-8" http-equiv="Content-Type"/><link href="inc/img/icons/iphone.png" rel="apple-touch-icon"/><link href="inc/img/icons/ipad.png" rel="apple-touch-icon" sizes="76x76"/><link href="inc/img/icons/iphone-retina.png" rel="apple-touch-icon" sizes="120x120"/><link href="inc/img/icons/ipad-retina.png" rel="apple-touch-icon" sizes="152x152"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><link href="/s/inc/opensearch.xml" rel="search" type="application/opensearchdescription+xml"/><link href="http://feeds.feedburner.com/Raymiiorg" rel="alternate" title="RSS Feed for Raymii.org" type="application/rss+xml"/></head><body><a id="top-of-page"></a><div class="container-fluid "><div class="row"><div class="col-md-12"><div class="col-md-3 col-sm-3 max-200"><div class="well well-none"><h3 class="headheader"><a href="https://raymii.org/s/">Raymii.org<img alt="IEC Resistor logo" src="https://raymii.org/s/inc/img/resistor-50.png"/></a></h3><h6 class="headheader">Quis custodiet ipsos custodes?</h6><h6><a href="http://feeds.feedburner.com/Raymiiorg">RSS Feed</a></h6></div><form action="https://encrypted.google.com/search" role="search"><div class="form-group"><input name="as_sitesearch" type="hidden" value="raymii.org"/><input name="as_qdr" type="hidden" value="all"/><input class="form-control" name="as_q" placeholder="Search" type="text"/></div></form><div class="menu"><ul class="nav nav-pills nav-stacked"><li><a class="special-menu" href="/s/index.html">Home</a></li><li class="bottom-spacing"><a class="special-menu" href="/s/everything.html">All Items</a></li><li><a class="link" href="/s/tags/bash.html">Bash</a></li><li><a class="link" href="/s/tags/monitoring.html">Monitoring</a></li><li><a class="link" href="/s/tags/ssl.html">SSL</a></li><li><a class="link" href="/s/tags/debian.html">Debian</a></li><li><a class="link" href="/s/tags/python.html">Python</a></li><li><a class="link" href="/s/tags/vpn.html">VPN</a></li><li><a class="link" href="/s/tags/ubuntu.html">Ubuntu</a></li><li><a class="link" href="/s/tags/nginx.html">nginx</a></li><li><a class="link" href="/s/tags/apache.html">Apache</a></li><li><a class="link" href="/s/tags/ansible.html">Ansible</a></li></ul><ul class="navbar-collapse nav navbar-nav"><li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Style<b class="caret"></b></a><ul class="dropdown-menu"><li><a href="#" onclick="setActiveStyleSheet('dark')">Dark</a></li><li><a href="#" onclick="setActiveStyleSheet('light')">Light</a></li></ul></li></ul><br/><br/><a href="http://clients.inceptionhosting.com/aff.php?aff=083">Inception Hosting Affiliate Link</a><br/> <a href="https://www.digitalocean.com/?refcode=7435ae6b8212">Digital Ocean Affiliate Link</a><br/><script type="text/javascript"><!--
                google_ad_client = "ca-pub-7993642564731324";
                google_ad_slot = "9322003332";
                google_ad_width = 200;
                google_ad_height = 200;
                //-->
                </script><script src="//pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
                </script></div></div><div class="col-md-8 col-sm-8"><div class="inner"><h2 class="headheader">IPv6 at Home</h2><ul class="breadcrumb"><li><a class="link" href="../index.html">Home</a></li><li><a class="link" href="../blog/index.html">Blog</a></li><li><a class="link" href="IPv6_at_Home.html">IPv6 at Home</a></li></ul><p><small>03-05-2014</small> | <small>Remy van Elst</small></p><div class="ad"><script type="text/javascript"><!--
                            google_ad_client = "ca-pub-7993642564731324";
                            /* voorartikel */
                            google_ad_slot = "6172324376";
                            google_ad_width = 728;
                            google_ad_height = 90;
                            //-->
                            </script><script src="//pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
                            </script></div><br/><p><img alt="ipv6-ready" src="https://raymii.org/s/inc/img/ipv6-ready.png"/></p><p>For a long time most of my VPS are IPv6 enabled. Raymii.org is reachable over IPv6. I've not had IPv6 at home yet, over my residential DSL line. And as you know, providers are not that fast with rolling out IPv6 at home. A friend pointed me to SixXS, which provide IPv6 tunnels. I had looked at them in the past, only then you needed to have a static IP for the tunnel. These days you don't need that anymore. Read on to find out how my IPv6 setup works, including privacy extensions and a few annoyances with Arch Linux and Ubuntu.</p><h3>The Tunnel</h3><p>The tunnel is provided by <a href="https://www.sixxs.net/">SixXS</a>. It is an <a href="http://en.wikipedia.org/wiki/Anything_In_Anything">AYIYA</a> tunnel, AYIYA is a protocol for managing IP tunneling protocols in use between separated IP networks. It is most often used to provide IPv6 transit over an IPv4 network link when network address translation masquerades a private network with a single IP address that may change frequently because of DHCP provisioning by Internet service providers.</p><p>Which basically means that you can use it to easily set up an IPv6 tunnel which works over a NATted LAN and thus you don't need a static IP anymore. As example, even at Starbucks I can set up my IPv6 tunnel without any hassle.</p><p>At SixXS you need to register and request a tunnel. You will need to provide some information, which will be validated, so make sure it is correct. Then you also need to provide a reason for your tunnel. Mine was just a simple one, I want to experiment at home with IPv6. They find that a valid reason, so in two days I had my tunnel data.</p><h3>Tunnel setup</h3><p>My DSL provider modem does not support IPv6 sadly, so I've spun up a Virtual Machine which will do the routing for IPv6. It is an Ubuntu 12.04 server machine on KVM. OpenVZ wo'nt work because of the advanced networking involved. It also will work on a Raspberry Pi with Raspbian, for those who do not want or have a (VM) server running all the time.</p><p>You will need all your SixXS data, as in, your account, tunnel and subnet.</p><p>First install <a href="https://www.sixxs.net/tools/aiccu/">AICCU</a>. It stands for: Automatic IPv6 Connectivity Client Utility. It is a tool to automatically configure IPv6 connectivity on a variety of platforms and it provides AYIYA and heartbeat protocol support.</p><pre><code>apt-get install aiccu
</code></pre><p>During the installation you will be asked for your SixXS username and password. These are the ones you use to login to the SixXS website.</p><p>If you only have one tunnel and subnet, it will all be set up automagically. I don't have multiple tunnels yet, but I expect it will require more configuration.</p><p>I had to change one line in the aiccu config file to make it work.</p><pre><code>vim /etc/aiccu.conf
</code></pre><p>Change the following from false to true and make sure it is not commented out:</p><pre><code>behindnat true
</code></pre><p>Now we can start the aiccu daemon:</p><pre><code>/etc/init.d/aiccu start
</code></pre><p>If you type the <code>ip a</code> command you should now see a new SixXS interface:</p><pre><code>8: sixxs: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1280 qdisc pfifo_fast state UNKNOWN qlen 500
    link/none 
    inet6 2001:[...]998::2/64 scope global 
       valid_lft forever preferred_lft forever
</code></pre><p>We can test it some more by accessing <a href="httpL//ipv6.google.com">Google over IPv6</a>:</p><pre><code>curl -g [2a00:1450:4013:c00::64]
</code></pre><p>The <code>-g</code> option is needed otherwise you will get either an <code>curl: (3) [globbing] error: bad range specification after pos 2</code> or an <code>curl: (3) IPv6 numerical address used in URL without brackets</code> error. See bug #30 on the <a href="http://curl.haxx.se/docs/knownbugs.html">Curl known bugs page</a></p><p>Response:</p><pre><code>&lt;HTML&gt;&lt;HEAD&gt;&lt;meta http-equiv="content-type" content="text/html;charset=utf-8"&gt;
&lt;TITLE&gt;302 Moved&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;
&lt;H1&gt;302 Moved&lt;/H1&gt;
The document has moved
&lt;A HREF="http://www.google.com/"&gt;here&lt;/A&gt;.
&lt;/BODY&gt;&lt;/HTML&gt;
</code></pre><h3>The routing</h3><p>The router needs to be able to forward IPv6 packets, so let's enable that. Edit <code>/etc/sysctl.conf</code>:</p><pre><code>vim /etc/sysctl.conf
</code></pre><p>Add or uncomment the following:</p><pre><code>net.ipv6.conf.all.forwarding=1
</code></pre><p>Apply the rule:</p><pre><code>sysctl -p
</code></pre><p>To give other machines an IPv6 address we need to install <code>radvd</code> and <code>dhcpv6</code>. Radvd will be used to provide addresses via <a href="https://www.sixxs.net/tools/dnscache/">SLAAC</a> and dhcpv6 will provide compatibility and DNS addresses.</p><pre><code>apt-get install wide-dhcpv6-server radvd
</code></pre><p>Configure Radvd via <code>/etc/radvd.conf</code>:</p><pre><code>vim /etc/radvd.conf
</code></pre><p>This is the config I use:</p><pre><code>interface eth0 {
      AdvSendAdvert on ;
      # Advertise at least every 30 seconds
      MaxRtrAdvInterval 30;
      # in order to force non RFC 6106 compliant clients to get a dns address
      AdvOtherConfigFlag on ;
      prefix $YOURSUBNET$/64 {
        AdvOnLink on;
        AdvAutonomous on;
      };
      RDNSS 2001:14b8:0:3401::6 2001:1418:10:2::2 {
      };
};
</code></pre><p>Replace <code>$YOURSUBNET$</code> with one of the subnets you gave from SixXS. The <code>RDNSS</code> option uses the europian DNS from SixXS. You can find other DNS cache servers <a href="https://www.sixxs.net/tools/dnscache/">here</a>.</p><p>Now configure DHCPv6:</p><pre><code>vim /etc/wide-dhcpv6/dhcp6s.conf
</code></pre><p>It has only the following line, to provide DNS:</p><pre><code>option domain-name-servers 2001:14b8:0:3401::6 2001:1418:10:2::2;
</code></pre><p>Here again you should use the SixXS DNS cache servers in your region.</p><p>Restart them both:</p><pre><code>/etc/init.d/radvd restart
/etc/init.d/wide-dhcpv6-server restart
</code></pre><h3>Privacy extensions</h3><p>The global address is used in IPv6 to communicate with the outside world. This is thus the one that is used as source for any communication and thus in a way identify you on Internet. The global address is built by using the prefix and adding an identifier build with the hardware address.</p><p>For example, the hardware address is 00:22:15:64:42:bd and the global IPv6 address is ending with 22:15ff:fe64:42bd. It is thus easy to go from the IPv6 global address to the hardware address. To fix this issue and increase the privacy of network user, privacy extensions have been developed.</p><p>You can read the RFC <a href="https://tools.ietf.org/html/rfc4941">here</a>, it describes how to build and use temporary addresses that will be used as source address for connection to the outside world. The <a href="http://en.wikipedia.org/wiki/IPv6">wikipedia</a> page describes it a bit more.</p><p>The option is documented in the <a href="http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=blob;f=Documentation/networking/ip-sysctl.txt;hb=HEAD">ip-sysctl.txt</a> file:</p><pre><code>use_tempaddr - INTEGER
    Preference for Privacy Extensions (RFC3041).
      &lt;= 0 : disable Privacy Extensions
      == 1 : enable Privacy Extensions, but prefer public
             addresses over temporary addresses.
      &gt;  1 : enable Privacy Extensions and prefer temporary
             addresses over public addresses.
    Default:  0 (for most devices)
             -1 (for point-to-point devices and loopback devices)
</code></pre><p>We can enable the privacy extensions on the Ubuntu/Debian router VM by defining it in /etc/sysctl.conf.</p><p>Edit <code>/etc/sysctl.conf</code>:</p><pre><code>vim /etc/sysctl.conf
</code></pre><p>Add the following line</p><pre><code>net.ipv6.conf.all.use_tempaddr=2
</code></pre><p>Apply it:</p><pre><code>sysctl -p
</code></pre><p>We also need to restart the network:</p><pre><code>/etc/init.d/networking restart
</code></pre><p>Using <code>ip a</code> you should now see a new address. It will expire after a while and a new one will be added. The default expiry time is one day. It can be changed with the following sysctl variable:</p><pre><code>net.ipv6.conf.eth0.temp_prefered_lft=7200
</code></pre><p>Where 7200 is the value in minutes. Change <code>eth0</code> to your network interface.</p><p>Don't set it to low, for me at 3600 I got errors like these:</p><pre><code>ipv6_create_tempaddr(): retry temporary address regeneration.
ipv6_create_tempaddr(): regeneration time exceeded. disabled temporary address support.
</code></pre><p>There are however some <a href="http://www.void.gr/kargig/blog/2013/02/23/linux-kernel-handling-of-ipv6-temporary-addresses-cve-2013-0343/">bugs</a> <a href="http://ipv6-or-no-ipv6.blogspot.nl/2013/02/ipv6-duplicate-address-in-linux.html">in</a> <a href="http://madduck.net/docs/ipv6/">the ipv6</a> <a href="https://bugzilla.redhat.com/show_bug.cgi?id=591630">stack</a>, so it might now all work as expected. For example, most of my laptops use Arch Linux with NetworkManager. Arch linux does not use <code>/etc/sysctl.conf</code> but uses <code>/etc/sysctl.d/00-files</code>. Therefore there is no <code>/etc/sysctl.conf</code> file. Networkmanager has hardcoded that it looks in <code>/etc/sysctl.conf</code> for the privacy extention setting. So that didn't work. You can set in in the config file for your network, for example, <code>/etc/NetworkManager/system-connections/name</code>:</p><pre><code>[ipv6]
method=auto
ip6-privacy=2
</code></pre><p>However, for me that didn't work until I created the <code>/etc/sysctl.conf</code> file with the privacy setting. I needed some more settings to make it all work on Arch:</p><pre><code>#cat /etc/sysctl.d/40-ipv6.conf 
net.ipv6.conf.all.use_tempaddr = 2
net.ipv6.conf.all.router_solicitation_delay=3
net.ipv6.conf.all.force_tllao=1
net.ipv6.conf.all.accept_dad=0
net.ipv6.conf.default.use_tempaddr = 2
</code></pre><h3>Testing it</h3><p>You should get an IPv6 address now. You can use sites like <a href="http://ipv6-test.com/">http://ipv6-test.com/</a> or by connecting to <a href="httpL//ipv6.google.com">http://ipv6.google.com</a>.</p><hr/>Tags: <a class="link" href="../tags/arch.html">arch,</a><a class="link" href="../tags/ip6.html">ip6,</a><a class="link" href="../tags/ip6tables.html">ip6tables,</a><a class="link" href="../tags/ipv6.html">ipv6,</a><a class="link" href="../tags/radvd.html">radvd,</a><a class="link" href="../tags/saac.html">saac,</a><a class="link" href="../tags/sixxs.html">sixxs,</a><a class="link" href="../tags/ubuntu.html">ubuntu,</a><div class="footer"><hr/><p>Generated by <a href="/s/software/ingsoc.html">ingsoc</a> | <a href="/s/software/Sparkling_Network.html">Cluster Status</a> | <a href="/s/static/About.html">About</a><br/></p></div></div></div></div></div></div><script type="text/javascript">
    var pkBaseURL = (("https:" == document.location.protocol) ? "https://hosted-oswa.org/piwik/" : "http://hosted-oswa.org/piwik/");
    document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
    </script><script type="text/javascript">
    try {
    var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 1);
    piwikTracker.trackPageView();
    piwikTracker.enableLinkTracking();
    } catch( err ) {}
    </script><noscript>&lt;p&gt;&lt;img src="http://hosted-oswa.org/piwik/piwik.php?idsite=1" style="border:0" alt="" /&gt;&lt;/p&gt;</noscript></body></html>