<!DOCTYPE html><html lang="en"><head><title>systemd: Don't fear change - Raymii.org</title><link href="/s/inc/css/custom-first.css" rel="stylesheet"/><link href="/s/inc/css/light.css" rel="stylesheet"/><link href="/s/inc/css/custom.css" rel="stylesheet" title="custom"/><meta content="text/html;charset=utf-8" http-equiv="Content-Type"/><link href="inc/img/icons/iphone.png" rel="apple-touch-icon"/><link href="inc/img/icons/ipad.png" rel="apple-touch-icon" sizes="76x76"/><link href="inc/img/icons/iphone-retina.png" rel="apple-touch-icon" sizes="120x120"/><link href="inc/img/icons/ipad-retina.png" rel="apple-touch-icon" sizes="152x152"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><link href="/s/inc/opensearch.xml" rel="search" type="application/opensearchdescription+xml"/><link href="https://raymii.org/s/feed.xml" rel="alternate" title="RSS Feed for Raymii.org" type="application/rss+xml"/></head><body><a id="top-of-page"></a><div class="container-fluid "><div class="row"><div class="col-md-12"><div class="col-md-3 col-sm-3 max-200"><div class="well well-none"><h3 class="headheader"><a href="https://raymii.org/s/">Raymii.org<img alt="IEC Resistor logo" src="/s/inc/img/resistor-50.png"/></a></h3><h6 class="headheader">Quis custodiet ipsos custodes?</h6><h6><a href="https://raymii.org/s/feed.xml">RSS Feed</a></h6></div><form action="https://encrypted.google.com/search" role="search"><div class="form-group"><input name="as_sitesearch" type="hidden" value="raymii.org"/><input name="as_qdr" type="hidden" value="all"/><input class="form-control" name="as_q" placeholder="Search" type="text"/></div></form><div class="menu"><ul class="nav nav-pills nav-stacked"><li><a class="special-menu" href="/s/index.html">Home</a></li><li class="bottom-spacing"><a class="special-menu" href="/s/everything.html">All Pages</a></li><li class="hideifsmall"><a class="link" href="/s/tags/bash.html">Bash</a></li><li class="hideifsmall"><a class="link" href="/s/tags/monitoring.html">Monitoring</a></li><li class="hideifsmall"><a class="link" href="/s/tags/ssl.html">SSL</a></li><li class="hideifsmall"><a class="link" href="/s/tags/debian.html">Debian</a></li><li class="hideifsmall"><a class="link" href="/s/tags/python.html">Python</a></li><li class="hideifsmall"><a class="link" href="/s/tags/vpn.html">VPN</a></li><li class="hideifsmall"><a class="link" href="/s/tags/ubuntu.html">Ubuntu</a></li><li class="hideifsmall"><a class="link" href="/s/tags/nginx.html">nginx</a></li><li class="hideifsmall"><a class="link" href="/s/tags/openstack.html">Openstack</a></li><li class="hideifsmall"><a class="link" href="/s/tags/ansible.html">Ansible</a></li></ul><a href="http://clients.inceptionhosting.com/aff.php?aff=083">Inception Hosting Affiliate Link</a><br/> <a href="https://www.digitalocean.com/?refcode=7435ae6b8212">Digital Ocean Affiliate Link, $10 free credit.</a><br/><script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" data-ad-client="ca-pub-7993642564731324" data-ad-slot="9322003332" style="display:inline-block;width:200px;height:200px"></ins><script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script></div></div><div class="col-md-8 col-sm-8"><div class="inner"><h2 class="headheader">systemd: Don't fear change</h2><ul class="breadcrumb"><li><a class="link" href="../index.html">Home</a></li><li><a class="link" href="../articles/index.html">Articles</a></li><li><a class="link" href="systemd_dont_fear_change.html">systemd: Don't fear change</a></li></ul><p><small>25-03-2015</small> | <small>Jonathan Roberts</small></p><div class="ad"><script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" data-ad-client="ca-pub-7993642564731324" data-ad-slot="6172324376" style="display:inline-block;width:728px;height:90px"></ins><script>
                            (adsbygoogle = window.adsbygoogle || []).push({});
                            </script></div><br/><p>This article was originaly published in <a href="http://www.linuxvoice.com/download-linux-voice-issue-1-with-audio/">Linux Voice, issue 1, April 2014</a>. This issue is now available under a <a href="https://creativecommons.org/licenses/by-sa/3.0/">Creative Commons BY-SA license</a>. In a nutshell: you can modify and share all content from the magazine (apart from adverts), even for commercial purposes, providing you credit Linux Voice as the original source, and retain the same license.</p><p>This remix is converted manually to Markdown and HTML for ease of archiving and copy-pasting.</p><p>If you like this, please subscribe to Linux Voice. It is an awesome magazine with an awesome team of people. <a href="http://shop.linuxvoice.com/">Click here to subscribe</a> from just GBP 38 and get future issues straight to your door or inbox! (DRM Free PDF's and more available).</p><p>If you like this website and want to support it AND get $10 Digital Ocean credit (2 months free), use this link to order: <a href="https://www.digitalocean.com/?refcode=7435ae6b8212">https://www.digitalocean.com/?refcode=7435ae6b8212</a> (referral link).</p><p>Other converted Linux Voice articles <a href="https://raymii.org/s/tags/linux-voice.html">can be found here</a>.</p><hr/><p>The init replacement for RHEL 7 and SUSE Enterprise Linux 12.</p><h3>systemd: Don't fear change</h3><p>The arrival of a new Linux init system has been a long time coming. It was back in 2006 that Upstart was introduced to Ubuntu, and around the same time that Fedora and others also started experimenting with new init systems.</p><p>The reasons then are much the same as the reasons now - sysvinit is old and doesn't do everything a modern distribution needs it to. More specifically:</p><ul><li>sysvinit can't take account of hot-pluggable hardware devices and filesystems, such as network mounts or USB sticks.</li><li>sysvinit doesn't provide sufficient supervision of processes, allowing double forked processes to become orphaned.</li><li>sysvinit can't parallelise boot services effectively, so it is slow.</li><li>sysvinit startup scripts are difficult to write, difficult to debug and can't easily be shared between distributions - the Sendmail init script is over 1,000 lines long!</li></ul><p>Systemd fixes these problems and introduces a number of new features that make the case for it even more compelling. Rather than explaining in great detail how systemd works or how it fixes these problems (there's plenty of information on that in <a href="http://0pointer.de/blog/projects/systemd.html">http://0pointer.de/blog/projects/systemd.html</a>, we're going to take a look at a few key features of systemd that might make sysadmins look forward to systemd, rather than dread having to learn a new tool.</p><h3>Configuration file format</h3><p>As mentioned above, in sysvinit systems, configuration of services was complex and error-prone. They were usually configured through a combination of arcane Bash scripts in <code>/etc/init.d</code> and some environmental settings in <code>/etc/sysconfig</code> or <code>/etc/defaults</code>. These init scripts often did awful amounts of work, such as echoing service status to the console and managing lock files, which were repeated in almost every init script.</p><p>Systemd removes the need for much of the complexity in these init scripts by handling service status echoes and suchlike itself. This means it can switch complex procedural Bash code for a clear, declarative configuration file. For example, here's the configuration for the syslog service on my Fedora system:</p><pre><code>[Unit]
Description=System Logging Service
[Service]
EnvironmentFile=-/etc/sysconfig/rsyslog
ExecStart=/sbin/rsyslogd -n $SYSLOGD_OPTIONS
Sockets=syslog.socket
StandardOutput=null
[Install]
WantedBy=multi-user.target
Alias=syslog.service
</code></pre><p>All of the configuration options available in these files are extremely well documented (systemd as a whole has some of the best docs around) - see <code>man systemd.unit</code> or <code>man systemd.service</code> for details.</p><p>What's more, if you had to modify a sysvinit file, you'd have to be careful when it came to package upgrades etc that your changes wouldn't get overwritten. With systemd, unit files get packaged into <code>/usr/lib/systemd/system</code>, but if you want to replace the default with your own, you can put them in <code>/etc/systemd/system</code> and whatever is there will take precedence over the defaults.</p><p>You can even include other unit configuration files in yours, so you can easily extend the default configuration:</p><pre><code>include /usr/lib/systemd/system/nfs-secure.service
#extra conf goes here
</code></pre><h3>Resource controls</h3><p>Why would you want to extend a service configuration like that? Well, systemd launches all processes inside their own cgroup (and all processes spawned from this end up in the same cgroup - this is also useful as it stops double forking processes from orphaning themselves), so you can take advantage of this to use cgroups to limit the resources that each process (and its child processes) can consume.</p><p>Systemd not only makes this possible by the way it spawns processes, but it also makes it easy by exposing many of the most common bits of functionality in configuration directives. For instance, you could limit the amount of CPU a process gets by dropping in a new unit configuration file to <code>/etc/systemd/system</code> and adding:</p><pre><code>[Service]
CpuShares=200
</code></pre><p>By default, systemd gives all processes (well, cgroups), an equal share of the processor (1024). By setting <code>CpuShares</code> to 200, you're restricting this process to about 20% of CPU time. What's more, this isn't applied just to the parent process but to all child processes. So if you have Apache running with many hundreds of spawned CGI processes, this would restrict all of those processes to about 20% of CPU time.</p><p>With the configuration file in place, you'd just need to tell systemd to reload it, with <code>systemctl daemon-reload</code>, and then restart the service, with <code>systemctl restart httpd.service</code>, for example.</p><p>You can also set memory limits (<code>MemoryLimit</code>) and IO limits (<code>BlockIOWeight</code>). See <code>man systemd.resource-control</code> for further details. There are also any number of security settings that can be put in the configuration files like this.</p><p>For example, you can restrict a service from accessing a particular device, make individual directory trees inaccessible or read-only, create a private <code>/tmp</code> directory for a service or even stop a service, and all its child processes, from accessing the network.</p><p>In the example below, we've configured a service to have a private /tmp directory. See how simple it is:</p><pre><code>[Service]
PrivateTmp=yes
</code></pre><h3>Journal</h3><p>Another aspect of systemd is that it collects all output from processes it starts - whether that's through <code>syslog()</code> calls, messages emitted to <code>STDOUT</code> or <code>STDERR</code>, initial RAM disk or kernel messages. It does this through one of its components, journald.</p><p>To see the contents of the logs, you can just type <code>journalctl</code> as root and you'll get the results displayed, just as if you were looking at the contents of <code>/var/log/messages</code> or similar. This default view gives you some simple improvements over the traditional techniques, however. Error and higher priority messages are in red, notice and warning are bold, timestamps are in your local timezone.</p><p>These are fairly cosmetic improvements. What sets journald apart is that the logs are kept on disk in a binary format, which means that the journal entries can be indexed on all fields, making them quick to search and easy to filter. For example:</p><pre><code>journalctl PRIORITY=7 -since=yesterday
</code></pre><p>Will show all messages of debug priority received by the journal since yesterday. If you tried to do this with standard syslog messages or the like, you'd have to concoct your own <code>grep</code> or <code>awk</code> command, or hook it in to a system like <code>Logstash</code> or <code>Splunk</code>.</p><p>There are loads of fields on which you can filter that come direct from the messages themselves, as well as a lot of metadata that the journal inputs in to each log message itself, including SELinux context, hostname, transport etc.</p><p>To see the full details, you can read <code>man systemd.journal-fields</code>.</p><p>Journalctl even features tab completion of possible field names, so you can get a quick look too by typing</p><pre><code>journalctl &lt;tab&gt;&lt;tab&gt;.
</code></pre><p>There are many other great features in systemd that, if you take the time to look around, will make your life as a sysadmin better.</p><p>We hope this article has at least given you the motivation to take a closer look.</p><hr/>Tags: <a class="link" href="../tags/centos.html">centos,</a><a class="link" href="../tags/init.html">init,</a><a class="link" href="../tags/linux-voice.html">linux-voice,</a><a class="link" href="../tags/linux-voice-issue-1-2014.html">linux-voice-issue-1-2014,</a><a class="link" href="../tags/systemd.html">systemd,</a><a class="link" href="../tags/upstart.html">upstart,</a><div class="footer"><hr/><p>Generated by <a href="/s/software/ingsoc.html">ingsoc</a> | <a href="/s/software/Sparkling_Network.html">Cluster Status</a> | <a href="/s/static/About.html">About</a><br/></p></div></div></div></div></div></div><script type="text/javascript">
    var pkBaseURL = (("https:" == document.location.protocol) ? "https://hosted-oswa.org/piwik/" : "http://hosted-oswa.org/piwik/");
    document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
    </script><script type="text/javascript">
    try {
    var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 1);
    piwikTracker.trackPageView();
    piwikTracker.enableLinkTracking();
    } catch( err ) {}
    </script><noscript>&lt;p&gt;&lt;img src="http://hosted-oswa.org/piwik/piwik.php?idsite=1" style="border:0" alt="" /&gt;&lt;/p&gt;</noscript></body></html>