<!DOCTYPE html><html lang="en"><head><title>HTTP Strict Transport Security for Apache, NGINX and Lighttpd - Raymii.org</title><link href="/s/inc/css/light.css" rel="stylesheet" title="light"/><link href="/s/inc/css/dark.css" rel="alternate stylesheet" title="dark"/><script async="" src="/s/inc/js/jquery-2.1.1.min.js"></script><script async="" src="/s/inc/js/bootstrap.3.2.0.min.js"></script><script async="" src="/s/inc/js/styleswitcher.js"></script><meta content="text/html;charset=utf-8" http-equiv="Content-Type"/><link href="inc/img/icons/iphone.png" rel="apple-touch-icon"/><link href="inc/img/icons/ipad.png" rel="apple-touch-icon" sizes="76x76"/><link href="inc/img/icons/iphone-retina.png" rel="apple-touch-icon" sizes="120x120"/><link href="inc/img/icons/ipad-retina.png" rel="apple-touch-icon" sizes="152x152"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><link href="/s/inc/opensearch.xml" rel="search" type="application/opensearchdescription+xml"/><link href="https://raymii.org/s/feed.xml" rel="alternate" title="RSS Feed for Raymii.org" type="application/rss+xml"/></head><body><a id="top-of-page"></a><div class="container-fluid "><div class="row"><div class="col-md-12"><div class="col-md-3 col-sm-3 max-200"><div class="well well-none"><h3 class="headheader"><a href="https://raymii.org/s/">Raymii.org<img alt="IEC Resistor logo" src="https://raymii.org/s/inc/img/resistor-50.png"/></a></h3><h6 class="headheader">Quis custodiet ipsos custodes?</h6><h6><a href="https://raymii.org/s/feed.xml">RSS Feed</a></h6></div><form action="https://encrypted.google.com/search" role="search"><div class="form-group"><input name="as_sitesearch" type="hidden" value="raymii.org"/><input name="as_qdr" type="hidden" value="all"/><input class="form-control" name="as_q" placeholder="Search" type="text"/></div></form><div class="menu"><ul class="nav nav-pills nav-stacked"><li><a class="special-menu" href="/s/index.html">Home</a></li><li class="bottom-spacing"><a class="special-menu" href="/s/everything.html">All Items</a></li><li><a class="link" href="/s/tags/bash.html">Bash</a></li><li><a class="link" href="/s/tags/monitoring.html">Monitoring</a></li><li><a class="link" href="/s/tags/ssl.html">SSL</a></li><li><a class="link" href="/s/tags/debian.html">Debian</a></li><li><a class="link" href="/s/tags/python.html">Python</a></li><li><a class="link" href="/s/tags/vpn.html">VPN</a></li><li><a class="link" href="/s/tags/ubuntu.html">Ubuntu</a></li><li><a class="link" href="/s/tags/nginx.html">nginx</a></li><li><a class="link" href="/s/tags/openstack.html">Openstack</a></li><li><a class="link" href="/s/tags/ansible.html">Ansible</a></li></ul><ul class="navbar-collapse nav navbar-nav"><li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Style<b class="caret"></b></a><ul class="dropdown-menu"><li><a href="#" onclick="setActiveStyleSheet('dark')">Dark</a></li><li><a href="#" onclick="setActiveStyleSheet('light')">Light</a></li></ul></li></ul><br/><br/><a href="http://clients.inceptionhosting.com/aff.php?aff=083">Inception Hosting Affiliate Link</a><br/> <a href="https://www.digitalocean.com/?refcode=7435ae6b8212">Digital Ocean Affiliate Link, $10 free credit.</a><br/><script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" data-ad-client="ca-pub-7993642564731324" data-ad-slot="9322003332" style="display:inline-block;width:200px;height:200px"></ins><script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script></div></div><div class="col-md-8 col-sm-8"><div class="inner"><h2 class="headheader">HTTP Strict Transport Security for Apache, NGINX and Lighttpd</h2><ul class="breadcrumb"><li><a class="link" href="../index.html">Home</a></li><li><a class="link" href="../tutorials/index.html">Tutorials</a></li><li><a class="link" href="HTTP_Strict_Transport_Security_for_Apache_NGINX_and_Lighttpd.html">HTTP Strict Transport Security for Apache, NGINX and Lighttpd</a></li></ul><p><small>29-12-2014</small> | <small>Remy van Elst</small></p><div class="ad"><script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" data-ad-client="ca-pub-7993642564731324" data-ad-slot="6172324376" style="display:inline-block;width:728px;height:90px"></ins><script>
                            (adsbygoogle = window.adsbygoogle || []).push({});
                            </script></div><br/><p>HTTP Strict Transport Security (often abbreviated as HSTS) is a security feature that lets a web site tell browsers that it should only be communicated with using HTTPS, instead of using HTTP. This tutorial will show you how to set up HSTS in Apache2, NGINX and Lighttpd. It is tested with all mentioned webservers, NGINX 1.1.19, Lighttpd 1.4.28 and Apache 2.2.22 on Ubuntu 12.04, Debian 6 &amp; 7 and CentOS 6.It should work on other distro's however, these are just reference values.</p><h3>What is HTTP Strict Transport Security?</h3><p>Quoting the <a href="https://developer.mozilla.org/en-US/docs/Security/HTTP_Strict_Transport_Security">Mozilla Developer Network</a>:</p><pre><code>If a web site accepts a connection through HTTP and redirects to HTTPS, the user in this case may initially talk to the non-encrypted version of the site before being redirected, if, for example, the user types http://www.foo.com/ or even just foo.com.

This opens up the potential for a man-in-the-middle attack, where the redirect could be exploited to direct a user to a malicious site instead of the secure version of the original page.

The HTTP Strict Transport Security feature lets a web site inform the browser that it should never load the site using HTTP, and should automatically convert all attempts to access the site using HTTP to HTTPS requests instead.
</code></pre><p>An example scenario:</p><pre><code>You log into a free WiFi access point at an airport and start surfing the web, visiting your online banking service to check your balance and pay a couple of bills. Unfortunately, the access point you're using is actually a hacker's laptop, and they're intercepting your original HTTP request and redirecting you to a clone of your bank's site instead of the real thing. Now your private data is exposed to the hacker.

Strict Transport Security resolves this problem; as long as you've accessed your bank's web site once using HTTPS, and the bank's web site uses Strict Transport Security, your browser will know to automatically use only HTTPS, which prevents hackers from performing this sort of man-in-the-middle attack.
</code></pre><p><em>Do note that HSTS does not work if you've never visited the website before.</em> A website needs to tell you it is HTTPS only.</p><h3>Set up HSTS in Apache2</h3><p>Edit your apache configuration file (<code>/etc/apache2/sites-enabled/website.conf</code> and <code>/etc/apache2/httpd.conf</code> for example) and add the following to your VirtualHost:</p><pre><code># Optionally load the headers module:
LoadModule headers_module modules/mod_headers.so

&lt;VirtualHost 67.89.123.45:443&gt;
    Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains"
&lt;/VirtualHost&gt;
</code></pre><p>Now your website will set the header every time someone visits, with an expiration date of two years (in seconds). It sets it at every visit. So tomorrow, it will say two years again.<br/> You do have to set it on the HTTPS vhost only. It cannot be in the http vhost.</p><p>To redirect your visitors to the HTTPS version of your website, use the following configuration:</p><pre><code>&lt;VirtualHost *:80&gt;
  [...]
  ServerName example.com
  Redirect permanent / https://example.com/
&lt;/VirtualHost&gt;
</code></pre><p>If you only redirect, you dont even need a document root.</p><p>You can also use mod<em>rewrite, however the above method is simpler and safer. However, mod</em>rewrite below redirects the user to the page they were visiting over https, the above config just redirects to /:</p><pre><code>&lt;VirtualHost *:80&gt;
  [...]
  &lt;IfModule mod_rewrite.c&gt;
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}
  &lt;/IfModule&gt;
&lt;/VirtualHost&gt;
</code></pre><p>And don't forget to restart Apache.</p><h3>Lighttpd</h3><p>The lighttpd variant is just as simple. Add it to your Lighttpd configuration file (<code>/etc/lighttpd/lighttpd.conf</code> for example):</p><pre><code>server.modules += ( "mod_setenv" )
$HTTP["scheme"] == "https" {
    setenv.add-response-header  = ( "Strict-Transport-Security" =&gt; "max-age=63072000")
}
</code></pre><p>And restart Lighttpd. Here the time is also two years.</p><h3>NGINX</h3><p>NGINX is even shorter with its config. Add this in the <code>server</code> block for your HTTPS configuration:</p><pre><code>add_header Strict-Transport-Security max-age=63072000;
</code></pre><p>Don't forget to restart NGINX.</p><h3>X-Frame-Options header</h3><p>The last tip I'll give you is the X-Frame-Options header, which you can add to your HTTPS website to make sure it is not embedded in a frame or iframe. This avoids clickjacking, and might be helpfull for HTTPS websites. Quoting the <a href="https://developer.mozilla.org/en-US/docs/HTTP/X-Frame-Options">Mozilla Developer Network again</a>:</p><pre><code>The X-Frame-Options HTTP response header can be used to indicate whether or not a browser should be allowed to render a page in a `&lt;frame&gt;` or `&lt;iframe&gt;`. Sites can use this to avoid clickjacking attacks, by ensuring that their content is not embedded into other sites.
</code></pre><p>You can change DENY to SAMEORIGIN or ALLOW-FROM uri, see the Mozilla link above for more information on that. (Or the <a href="http://tools.ietf.org/html/rfc7034">RFC</a>.)</p><h4>X-Frame-Options for Apache2</h4><p>As above, add this to the apache config file:</p><pre><code>Header always set X-Frame-Options DENY
</code></pre><h3>Lighttpd</h3><p>This goes in the lighttpd config. Make sure you don't double the above set config, if you have that, just add the rule it to it.</p><pre><code>server.modules += ( "mod_setenv" )
$HTTP["scheme"] == "https" {
    setenv.add-response-header  = ( "X-Frame-Options" =&gt; "DENY")
}
</code></pre><h4>NGINX</h4><p>Yet again, in a <code>server</code> block:</p><pre><code>add_header X-Frame-Options DENY;
</code></pre><hr/>Tags: <a class="link" href="../tags/apache.html">apache,</a><a class="link" href="../tags/hsts.html">hsts,</a><a class="link" href="../tags/https.html">https,</a><a class="link" href="../tags/lighttpd.html">lighttpd,</a><a class="link" href="../tags/nginx.html">nginx,</a><a class="link" href="../tags/security.html">security,</a><a class="link" href="../tags/ssl.html">ssl,</a><a class="link" href="../tags/tls.html">tls,</a><div class="footer"><hr/><p>Generated by <a href="/s/software/ingsoc.html">ingsoc</a> | <a href="/s/software/Sparkling_Network.html">Cluster Status</a> | <a href="/s/static/About.html">About</a><br/></p></div></div></div></div></div></div><script type="text/javascript">
    var pkBaseURL = (("https:" == document.location.protocol) ? "https://hosted-oswa.org/piwik/" : "http://hosted-oswa.org/piwik/");
    document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
    </script><script type="text/javascript">
    try {
    var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 1);
    piwikTracker.trackPageView();
    piwikTracker.enableLinkTracking();
    } catch( err ) {}
    </script><noscript>&lt;p&gt;&lt;img src="http://hosted-oswa.org/piwik/piwik.php?idsite=1" style="border:0" alt="" /&gt;&lt;/p&gt;</noscript></body></html>