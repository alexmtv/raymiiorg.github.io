<!-- nominify -->



    <!DOCTYPE html>
    <html lang="en">
        <head>
        <title>OSSEC 2.8 Server, Client, Web UI and Analogi Dashboard Installation tutorial - Raymii.org</title>
        <link href="/s/inc/css/light.css" rel="stylesheet" title="light" />
        <link href="/s/inc/css/dark.css" rel="alternate stylesheet" title="dark" />
        <script async src="/s/inc/js/jquery-2.1.1.min.js"></script>
        <script async src="/s/inc/js/bootstrap.3.2.0.min.js"></script>
        <script async src="/s/inc/js/styleswitcher.js"></script>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <link href="inc/img/icons/iphone.png" rel="apple-touch-icon" />
        <link href="inc/img/icons/ipad.png" rel="apple-touch-icon" sizes="76x76" />
        <link href="inc/img/icons/iphone-retina.png" rel="apple-touch-icon" sizes="120x120" />
        <link href="inc/img/icons/ipad-retina.png" rel="apple-touch-icon" sizes="152x152" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link type="application/opensearchdescription+xml" rel="search" href="/s/inc/opensearch.xml"/>
        <link rel="alternate" type="application/rss+xml" title="RSS Feed for Raymii.org" href="https://raymii.org/s/feed.xml" />
    </head>
    <body>
        <a id="top-of-page"></a>
        <div class="container-fluid ">
            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-3 col-sm-3 max-200">
                        <div class="well well-none"> 
                            <h3 class="headheader"><a href="https://raymii.org/s/">Raymii.org <img src="https://raymii.org/s/inc/img/resistor-50.png" alt="IEC Resistor logo"></a></h3>
                            <h6 class="headheader">Quis custodiet ipsos custodes?</h6>
                            <h6><a href="https://raymii.org/s/feed.xml">RSS Feed</a></h6>
                        </div>
          

    
    <form role="search" action="https://encrypted.google.com/search">
        <div class="form-group">
          <input type="hidden" name="as_sitesearch" value="raymii.org">
          <input type="hidden" name="as_qdr" value="all">
          <input type="text" name="as_q" class="form-control" placeholder="Search">
        </div>
      </form>
      <div class="menu"><ul class="nav nav-pills nav-stacked"><li><a href="/s/index.html" class="special-menu">Home</a></li><li class='bottom-spacing'><a href="/s/everything.html" class="special-menu">All Items</a></li><li><a href="/s/tags/bash.html" class="link">Bash</a></li><li><a href="/s/tags/monitoring.html" class="link">Monitoring</a></li><li><a href="/s/tags/ssl.html" class="link">SSL</a></li><li><a href="/s/tags/debian.html" class="link">Debian</a></li><li><a href="/s/tags/python.html" class="link">Python</a></li><li><a href="/s/tags/vpn.html" class="link">VPN</a></li><li><a href="/s/tags/ubuntu.html" class="link">Ubuntu</a></li><li><a href="/s/tags/nginx.html" class="link">nginx</a></li><li><a href="/s/tags/openstack.html" class="link">Openstack</a></li><li><a href="/s/tags/ansible.html" class="link">Ansible</a></li></ul>
                <ul class="navbar-collapse nav navbar-nav">
                <li class="dropdown">
                <a data-toggle="dropdown" class="dropdown-toggle" href="#">Style<b class="caret"></b></a>
                <ul class="dropdown-menu">
                <li><a href="#" onclick="setActiveStyleSheet('dark')">Dark</a></li>
                <li><a href="#" onclick="setActiveStyleSheet('light')">Light</a></li>
                </ul>
                </li>
                </ul>
                <br><br>
               <!-- advertisement start -->
                <a href="http://clients.inceptionhosting.com/aff.php?aff=083">Inception Hosting Affiliate Link</a><br />
                <a href="https://www.digitalocean.com/?refcode=7435ae6b8212">Digital Ocean  Affiliate Link</a><br />
                <script type="text/javascript"><!--
                google_ad_client = "ca-pub-7993642564731324";
                google_ad_slot = "9322003332";
                google_ad_width = 200;
                google_ad_height = 200;
                //-->
                </script>
                <script type="text/javascript"
                src="//pagead2.googlesyndication.com/pagead/show_ads.js">
                </script>    
                <!-- advertisement end -->
                </div>
           </div>  
           <div class="col-md-8 col-sm-8"> 
                <div class="inner">

           <h2 class='headheader'>OSSEC 2.8 Server, Client, Web UI and Analogi Dashboard Installation tutorial</h2><ul class="breadcrumb"><li><a href="../index.html" class="link">Home</a></li><li><a href="../tutorials/index.html" class="link">Tutorials</a></li><li><a href="OSSEC_2.8.0_Server_Client_and_Analogi_Dashboard_on_Ubuntu.html" class="link">OSSEC 2.8 Server, Client, Web UI and Analogi Dashboard Installation tutorial</a></li></ul><p><small>11-06-2014</small> | <small>Remy van Elst</small></p><div class='ad'>
                            <script type="text/javascript"><!--
                            google_ad_client = "ca-pub-7993642564731324";
                            /* voorartikel */
                            google_ad_slot = "6172324376";
                            google_ad_width = 728;
                            google_ad_height = 90;
                            //-->
                            </script>
                            <script type="text/javascript"
                            src="//pagead2.googlesyndication.com/pagead/show_ads.js">
                            </script>
                        </div><br><p>OSSEC is an Open Source Host-based Intrusion Detection System that performs log analysis, file integrity checking, policy monitoring, rootkit detection, real-time alerting and active response. It runs on most operating systems, including Linux, MacOS, Solaris, HP-UX, AIX and Windows. It also includes agentless monitoring for use with for example Cisco, HP or Juniper hardware.</p>

<p>OSSEC 2.8 was <a href="http://www.ossec.net/?p=1098">released on the 4th of June, 2014</a>. You can find the <a href="http://www.ossec.net/files/ossec-hids-2.8-release-note.txt">full release notes here</a>. New features include outputing of all alerts to a zeromq PUB socket in JSON, more sshd rules and a lot of bugfixes.</p>

<p><a href="https://www.digitalocean.com/?refcode=7435ae6b8212">This tutorial was tested on a DigitalOcean VPS. If you use this link you sponsor this website. (referral link)</a></p>

<p>This tutorial covers the installation of the OSSEC 2.8.0 server, the standard OSSEC Web UI and the Analogi dashboard on Ubuntu 14.04. It also covers OSSEC setup with MySQL support. Last but not least it shows you how to install the OSSEC agent on a *NIX system.</p>

<p><a href="https://raymii.org/s/inc/img/ossec/analogi-2.8.png"><img src="https://raymii.org/s/inc/img/ossec/analogi-2.8.png" width="320" height="240" alt="OSSEC Analogi dashboard" /></a></p>

<p>This tutorial is written for an Ubuntu 14.04 OSSEC 2.8.0 server, but can be easily adapted to other *NIX operating systems. It only covers basic OSSEC client/server configuration. It gets you started, the rest is available in the documentation: http://www.ossec.net/doc/</p>

<p>You can read the tutorial for <a href="https://raymii.org/s/tutorials/OSSEC_and_webui_and_analogi_dashboard_installation_on_Ubuntu.html">OSSEC 2.7 on Ubuntu 12.04 here.</a></p>

<h3>Requirements</h3>

<ul>
<li>An Ubuntu 14.04 server</li>
<li>Apache2, PHP, MySQL and development packages</li>
<li>OSSEC clients to monitor (*NIX or Windows machines, Cisco switches etc).</li>
</ul>

<h3>Installing development packages</h3>

<p>OSSEC is installed from source, therefore you need development packages. This is both for the OSSEC clients as for the OSSEC server:</p>

<pre><code>apt-get install build-essential make libssl-dev git
</code></pre>

<h3>Installing Apache, MySQL and PHP</h3>

<p>This is fairly simple on Ubuntu. It is all covered with apt:</p>

<pre><code>apt-get install mysql-server libmysqlclient-dev mysql-client apache2 php5 libapache2-mod-php5 php5-mysql php5-curl php5-gd php5-intl php-pear php5-imagick php5-imap php5-mcrypt php5-memcache php5-ming php5-ps php5-pspell php5-recode php5-snmp php5-sqlite php5-tidy php5-xmlrpc php5-xsl
</code></pre>

<p>Remember to set a strong root password for MySQL. Next finish MySQL with a secure installation:</p>

<pre><code>mysql_secure_installation
</code></pre>

<p>Accept all the suggested options. Now restart all requires services:</p>

<pre><code>/etc/init.d/apache2 restart
/etc/init.d/mysql restart
</code></pre>

<h3>Compiling the OSSEC server</h3>

<p>Do note that OSSEC has Debian packages available. These do not include MySQL or Postgres support, therefore we need to compile it. The packages are also at the moment only available for OSSEC 2.7. </p>

<p>Download and verify OSSEC, either via wget or from the website: http://www.ossec.net/?page_id=19</p>

<pre><code>wget http://www.ossec.net/files/ossec-hids-2.8.tar.gz

md5sum ossec-hids-2.8.tar.gz
ossec-hids-2.8.tar.gz: 90f3c54f22abe9c07661fb51ddaa8474
</code></pre>

<p>From the OSSEC website:</p>

<pre><code>MD5(ossec-hids-2.8.tar.gz)= 90f3c54f22abe9c07661fb51ddaa8474
SHA1(ossec-hids-2.8.tar.gz)= 1d72a8cd347379ef7a533ba9633231c5bfedfa1a
</code></pre>

<p>If it is correct, then extract it:</p>

<pre><code>tar -xf ossec-hids-2.8.tar.gz
cd ossec-hids-2.8
</code></pre>

<h4>Database support</h4>

<p>The Makefile error is fixed in 2.8. </p>

<p>This tutorial uses MySQL because the Analogi dashboard only supports MySQL. Instructions for Postgres are included.</p>

<p>Enable database support:</p>

<pre><code>cd src
make setdb
Error: PostgreSQL client libraries not installed.

Info: Compiled with MySQL support.
</code></pre>

<p>If you want postgres support, install <code>postgresql-server-dev-9.3</code>.</p>

<p>Continue with the compilation/installation:</p>

<pre><code>cd ../
./install.sh

      ** Para instalao em portugus, escolha [br].
  ** ,  [cn].
  ** Fur eine deutsche Installation wohlen Sie [de].
  **    ,  [el].
  ** For installation in English, choose [en].
  ** Para instalar en Espaol , eliga [es].
  ** Pour une installation en franais, choisissez [fr]
  ** A Magyar nyelv teleptshez vlassza [hu].
  ** Per l&#39;installazione in Italiano, scegli [it].
  ** [jp].
  ** Voor installatie in het Nederlands, kies [nl].
  ** Aby instalowa w jzyku Polskim, wybierz [pl].
  **       , [ru].
  ** Za instalaciju na srpskom, izaberi [sr].
  ** Trke kurulum iin sein [tr].
  (en/br/cn/de/el/es/fr/hu/it/jp/nl/pl/ru/sr/tr) [en]: 


 OSSEC HIDS v2.8 Installation Script - http://www.ossec.net

 You are about to start the installation process of the OSSEC HIDS.
 You must have a C compiler pre-installed in your system.
 If you have any questions or comments, please send an e-mail
 to dcid@ossec.net (or daniel.cid@gmail.com).

  - System: Linux ossec 3.13.0-24-generic
  - User: root
  - Host: ossec


  -- Press ENTER to continue or Ctrl-C to abort. --


1- What kind of installation do you want (server, agent, local, hybrid or help)? server

  - Server installation chosen.

2- Setting up the installation environment.

 - Choose where to install the OSSEC HIDS [/var/ossec]: 

    - Installation will be made at  /var/ossec .

3- Configuring the OSSEC HIDS.

  3.1- Do you want e-mail notification? (y/n) [y]: 
   - What&#39;s your e-mail address? user@example.org
   - What&#39;s your SMTP server ip/host? smtp.gmail.com

  3.2- Do you want to run the integrity check daemon? (y/n) [y]: 

   - Running syscheck (integrity check daemon).

  3.3- Do you want to run the rootkit detection engine? (y/n) [y]: 

   - Running rootcheck (rootkit detection).

  3.4- Active response allows you to execute a specific 
       command based on the events received. For example,
       you can block an IP address or disable access for
       a specific user.  
       More information at:
       http://www.ossec.net/en/manual.html#active-response

   - Do you want to enable active response? (y/n) [y]: 

     - Active response enabled.

   - By default, we can enable the host-deny and the 
     firewall-drop responses. The first one will add
     a host to the /etc/hosts.deny and the second one
     will block the host on iptables (if linux) or on
     ipfilter (if Solaris, FreeBSD or NetBSD).
   - They can be used to stop SSHD brute force scans, 
     portscans and some other forms of attacks. You can 
     also add them to block on snort events, for example.

   - Do you want to enable the firewall-drop response? (y/n) [y]: 

     - firewall-drop enabled (local) for levels &gt;= 6

   - Default white list for the active response:
      - 194.60.207.52
      - 194.60.207.53
      - 79.170.92.7

   - Do you want to add more IPs to the white list? (y/n)? [n]: 

  3.5- Do you want to enable remote syslog (port 514 udp)? (y/n) [y]: 

   - Remote syslog enabled.

  3.6- Setting the configuration to analyze the following logs:
    -- /var/log/auth.log
    -- /var/log/syslog
    -- /var/log/dpkg.log
    -- /var/log/apache2/error.log (apache log)
    -- /var/log/apache2/access.log (apache log)

 - If you want to monitor any other file, just change 
   the ossec.conf and add a new localfile entry.
   Any questions about the configuration can be answered
   by visiting us online at http://www.ossec.net .

5- Installing the system
 - Running the Makefile
INFO: Little endian set.

 *** Making zlib (by Jean-loup Gailly and Mark Adler)  *** 

[...]

 *** Making cJSON (by Dave Gamble)  *** 

[...]

 *** Making Lua 5.2 (by team at PUC-Rio in Brazi)  *** 

[...]

 *** Making os_xml *** 

[...]

 *** Making os_regex *** 

[...]

 *** Making os_net *** 

[...]

 *** Making os_crypto *** 

[...]

 *** Making shared *** 

[...]

 *** Making config *** 

[...]

 *** Making os_maild *** 

[...]

 *** Making os_dbd *** 

make[1]: Entering directory `/root/ossec-hids-2.8/src/os_dbd&#39;
Compiling DB support with: 
cc -g -Wall -I../ -I../headers  -DDEFAULTDIR=\&quot;/var/ossec\&quot; -DUSE_OPENSSL -DUSEINOTIFY      -DARGV0=\&quot;ossec-dbd\&quot; -DOSSECHIDS   *.c ../config/lib_config.a ../shared/lib_shared.a ../os_net/os_net.a ../os_regex/os_regex.a ../os_xml/os_xml.a -o ossec-dbd -I/usr/include/mysql -DBIG_JOINS=1  -fno-strict-aliasing   -g -DNDEBUG -L/usr/lib/x86_64-linux-gnu -lmysqlclient -lpthread -lz -lm -ldl -DDBD -DUMYSQL 
make[1]: Leaving directory `/root/ossec-hids-2.8/src/os_dbd&#39;


 *** Making os_csyslogd *** 

[...]

 *** Making agentlessd *** 

[...]

 *** Making os_execd *** 

[...]

 *** Making analysisd *** 

[...]

 *** Making logcollector *** 

[...]

 *** Making remoted *** 

[...]

 *** Making client-agent *** 

[...]

 *** Making addagent *** 

[...]

 *** Making util *** 

[...]

 *** Making rootcheck *** 

[...]

 *** Making syscheckd *** 

[...]

 *** Making monitord *** 

[...]

 *** Making os_auth *** 

[...]

 - System is Debian (Ubuntu or derivative).
 - Init script modified to start OSSEC HIDS during boot.

 - Configuration finished properly.

 - To start OSSEC HIDS:
        /var/ossec/bin/ossec-control start

 - To stop OSSEC HIDS:
        /var/ossec/bin/ossec-control stop

 - The configuration can be viewed or modified at /var/ossec/etc/ossec.conf


    Thanks for using the OSSEC HIDS.
    If you have any question, suggestion or if you find any bug,
    contact us at contact@ossec.net or using our public maillist at
    ossec-list@ossec.net
    ( http://www.ossec.net/main/support/ ).

    More information can be found at http://www.ossec.net

    ---  Press ENTER to finish (maybe more information below). ---

 - In order to connect agent and server, you need to add each agent to the server.
   Run the &#39;manage_agents&#39; to add or remove them:

   /var/ossec/bin/manage_agents

   More information at: 
   http://www.ossec.net/en/manual.html#ma
</code></pre>

<p>OSSEC is now installed. Restart it:</p>

<pre><code>/var/ossec/bin/ossec-control restart
</code></pre>

<h3>Configuring MySQL</h3>

<p>We need to create a user and database for OSSEC. Open a MySQL shell:</p>

<pre><code>mysql -u root -p
Enter password:
[...]

mysql&gt; create database ossec;
Query OK, 1 row affected (0.00 sec)

grant INSERT,SELECT,UPDATE,CREATE,DELETE,EXECUTE on ossec.* to ossec_u;
Query OK, 0 rows affected (0.00 sec)

set password for ossec_u = PASSWORD(&#39;Passw0rd&#39;);
Query OK, 1 row affected (0.00 sec)

flush privileges;
Query OK, 0 rows affected (0.00 sec)

quit;
</code></pre>

<p>The database also needs a schema. OSSEC provides the schema, it is located in the extracted OSSEC folder, <code>src/os_dbd</code>. </p>

<p>Import it into MySQL:</p>

<pre><code>mysql -u root -p ossec &lt; src/os_dbd/mysql.schema
</code></pre>

<h3>OSSEC MySQL configuration</h3>

<p>We have to add the database config to <code>/var/ossec/etc/ossec.conf</code>:</p>

<pre><code>&lt;ossec_config&gt;
    &lt;database_output&gt;
        &lt;hostname&gt;127.0.0.1&lt;/hostname&gt;
        &lt;username&gt;ossec_u&lt;/username&gt;
        &lt;password&gt;Passw0rd&lt;/password&gt;
        &lt;database&gt;ossec&lt;/database&gt;
        &lt;type&gt;mysql&lt;/type&gt;
    &lt;/database_output&gt;
&lt;/ossec_config&gt;
</code></pre>

<p>Change <code>type mysql</code> to <code>type postgresql</code> for the PostgreSQL database.</p>

<p>Save it, then enable the database in OSSEC:</p>

<pre><code>/var/ossec/bin/ossec-control enable database
/var/ossec/bin/ossec-control restart 
</code></pre>

<h3>Installing OSSEC Web UI</h3>

<p><a href="https://raymii.org/s/inc/img/ossec/webui-2.8.png"><img src="https://raymii.org/s/inc/img/ossec/webui-2.8.png" width="320" height="240" alt="OSSEC Web UI" /></a></p>

<p>This is also quite simple. Because we&#39;ve already set up Apache and PHP, we can just download the web UI and extract to <code>/var/www/html</code>:</p>

<pre><code>wget http://www.ossec.net/files/ossec-wui-0.8.tar.gz
tar -xf ossec-wui-0.8.tar.gz
mkdir -p /var/www/html/ossec/tmp/
mv ossec-wui-0.8/* /var/www/html/ossec/
chown www-data:www-data /var/www/html/ossec/tmp/
chmod 666 /var/www/html/ossec/tmp
</code></pre>

<p>Make sure the <code>www-data</code> user can access the ossec folder:</p>

<pre><code>usermod -a -G ossec www-data
</code></pre>

<p>We use version 0.8 of Web UI because there are a lot of errors (like broken search) in the stable 0.3 version. We also set the correct permissions on the <code>tmp/</code> folder. Afterwards the web ui is visible at <code>http://hostname/ossec/</code>.</p>

<h3>Installing Analogi Web Dashboard</h3>

<p><a href="https://raymii.org/s/inc/img/ossec/analogi-2.8.png"><img src="https://raymii.org/s/inc/img/ossec/analogi-2.8.png" width="320" height="240" alt="OSSEC Analogi dashboard" /></a></p>

<p><a href="https://www.digitalocean.com/?refcode=7435ae6b8212">This tutorial was tested on a DigitalOcean VPS. If you use this link you sponsor this website. (referral link)</a></p>

<p>The Analogi dashboard is a nice and informative dashboard around OSSEC, which provides more visual information then the standard Web UI. The standard Web UI has better search functions, the Dashboard can be used for example on a Wall Mounted monitor and such.</p>

<p>Installation consists out of cloning the git repo and editing the settings file:</p>

<pre><code>cd /var/www/html/
git clone https://github.com/ECSC/analogi.git
cp analogi/db_ossec.php.new analogi/db_ossec.php
vim analogi/db_ossec.php        
</code></pre>

<p>Edit the relevant settings for the MySQL database configuration: </p>

<pre><code>define (&#39;DB_USER_O&#39;, &#39;ossec_u&#39;);
define (&#39;DB_PASSWORD_O&#39;, &#39;Passw0rd&#39;);
define (&#39;DB_HOST_O&#39;, &#39;127.0.0.1&#39;);
define (&#39;DB_NAME_O&#39;, &#39;ossec&#39;);
</code></pre>

<p>When correctly configured the Analogi webinterface can be found at http://hostname/analogi/.</p>

<p>The OSSEC server is now correctly set up. </p>

<h3>Client installation</h3>

<p>Download and verify the OSSEC 2.8 .tar.gz file as described above. Don&#39;t forget to install the development packages. This time, do an agent installation. See the output below:</p>

<pre><code># ./install.sh 

  ** Para instalao em portugus, escolha [br].
  ** ,  [cn].
  ** Fur eine deutsche Installation wohlen Sie [de].
  **    ,  [el].
  ** For installation in English, choose [en].
  ** Para instalar en Espaol , eliga [es].
  ** Pour une installation en franais, choisissez [fr]
  ** A Magyar nyelv teleptshez vlassza [hu].
  ** Per l&#39;installazione in Italiano, scegli [it].
  ** [jp].
  ** Voor installatie in het Nederlands, kies [nl].
  ** Aby instalowa w jzyku Polskim, wybierz [pl].
  **       , [ru].
  ** Za instalaciju na srpskom, izaberi [sr].
  ** Trke kurulum iin sein [tr].
  (en/br/cn/de/el/es/fr/hu/it/jp/nl/pl/ru/sr/tr) [en]: 


 OSSEC HIDS v2.8 Installation Script - http://www.ossec.net

 You are about to start the installation process of the OSSEC HIDS.
 You must have a C compiler pre-installed in your system.
 If you have any questions or comments, please send an e-mail
 to dcid@ossec.net (or daniel.cid@gmail.com).

  - System: Linux ossec-client 3.13.0-24-generic
  - User: root
  - Host: ossec-client


  -- Press ENTER to continue or Ctrl-C to abort. --


1- What kind of installation do you want (server, agent, local, hybrid or help)? agent

  - Agent(client) installation chosen.

2- Setting up the installation environment.

 - Choose where to install the OSSEC HIDS [/var/ossec]: 

    - Installation will be made at  /var/ossec .

3- Configuring the OSSEC HIDS.

  3.1- What&#39;s the IP Address or hostname of the OSSEC HIDS server?: 1.2.3.4

   - Adding Server IP 1.2.3.4

  3.2- Do you want to run the integrity check daemon? (y/n) [y]: 

   - Running syscheck (integrity check daemon).

  3.3- Do you want to run the rootkit detection engine? (y/n) [y]: 

   - Running rootcheck (rootkit detection).

  3.4 - Do you want to enable active response? (y/n) [y]: 


  3.5- Setting the configuration to analyze the following logs:
    -- /var/log/auth.log
    -- /var/log/syslog
    -- /var/log/dpkg.log

 - If you want to monitor any other file, just change 
   the ossec.conf and add a new localfile entry.
   Any questions about the configuration can be answered
   by visiting us online at http://www.ossec.net .


   --- Press ENTER to continue ---


    5- Installing the system
     - Running the Makefile
    INFO: Little endian set.

     *** Making zlib (by Jean-loup Gailly and Mark Adler)  *** 

    [...]

     *** Making cJSON (by Dave Gamble)  *** 

    [...]

     *** Making Lua 5.2 (by team at PUC-Rio in Brazi)  *** 

     [...]

     *** Making os_xml *** 

    [...]

     *** Making os_regex *** 

    [...]

     *** Making os_net *** 

    [...]

     *** Making os_crypto *** 

    [...]

     *** Making shared *** 

    [...]

     *** Making config *** 

    [...]

     *** Making os_maild *** 

    [...]

     *** Making os_dbd *** 

    [...]

     *** Making os_csyslogd *** 

    [...]

     *** Making agentlessd *** 

    [...]

     *** Making os_execd *** 

    [...]

     *** Making analysisd *** 

    [...]

     *** Making logcollector *** 

    [...]

     *** Making remoted *** 

    [...]

     *** Making client-agent *** 

    [...]

     *** Making addagent *** 

    [...]

     *** Making util *** 

    [...]

     *** Making rootcheck *** 

    [...]

     *** Making syscheckd *** 

    [...]

     *** Making monitord *** 

    [...]

     *** Making os_auth *** 

    [...]

     - System is Debian (Ubuntu or derivative).
     - Init script modified to start OSSEC HIDS during boot.

     - Configuration finished properly.

     - To start OSSEC HIDS:
            /var/ossec/bin/ossec-control start

     - To stop OSSEC HIDS:
            /var/ossec/bin/ossec-control stop

     - The configuration can be viewed or modified at /var/ossec/etc/ossec.conf


        Thanks for using the OSSEC HIDS.
        If you have any question, suggestion or if you find any bug,
        contact us at contact@ossec.net or using our public maillist at
        ossec-list@ossec.net
        ( http://www.ossec.net/main/support/ ).

        More information can be found at http://www.ossec.net

        ---  Press ENTER to finish (maybe more information below). ---
</code></pre>

<h4>Client OSSEC config</h4>

<p>Adding a client to OSSEC is quite simple. First you add the client to the server, which gives you a key. Then you add this key to the client, edit the config file on the client and that&#39;s it.</p>

<p>First we need to generate a key on the OSSEC server for this client. We do this by running <code>/var/ossec/bin/manage_agents</code>, option A, then entering the hostname, IP and ID for the client we want to add. Do this on the OSSEC server:</p>

<pre><code>root@ossec:~# /var/ossec/bin/manage_agents
****************************************
* OSSEC HIDS v2.8 Agent manager.     *
* The following options are available: *
****************************************
   (A)dd an agent (A).
   (E)xtract key for an agent (E).
   (L)ist already added agents (L).
   (R)emove an agent (R).
   (Q)uit.
Choose your action: A,E,L,R or Q: A

- Adding a new agent (use &#39;\q&#39; to return to the main menu).
  Please provide the following:
   * A name for the new agent: ossec-client1
   * The IP Address of the new agent: 2.3.4.5
   * An ID for the new agent[001]: 
Agent information:
   ID:001
   Name:ossec-client1
   IP Address:2.3.4.5

Confirm adding it?(y/n): y
Agent added.
</code></pre>

<p>Get the key for the OSSEC client:</p>

<pre><code>root@ossec:~# /var/ossec/bin/manage_agents

****************************************
* OSSEC HIDS v2.8 Agent manager.     *
* The following options are available: *
****************************************
   (A)dd an agent (A).
   (E)xtract key for an agent (E).
   (L)ist already added agents (L).
   (R)emove an agent (R).
   (Q)uit.
Choose your action: A,E,L,R or Q: E

Available agents:
   ID: 001, Name: ossec-client1, IP: 2.3.4.5
Provide the ID of the agent to extract the key (or &#39;\q&#39; to quit): 001

Agent key information for &#39;001&#39; is:
SD[...]AAUjd=

** Press ENTER to return to the main menu.
</code></pre>

<p>Then switch to the OSSEC client and execute the manage_agents:</p>

<pre><code>root@ossec:~# /var/ossec/bin/manage_agents

****************************************
* OSSEC HIDS v2.8 Agent manager.     *
* The following options are available: *
****************************************
   (I)mport key from the server (I).
   (Q)uit.
Choose your action: I or Q: i

* Provide the Key generated by the server.
* The best approach is to cut and paste it.
*** OBS: Do not include spaces or new lines.

Paste it here (or &#39;\q&#39; to quit): SD[...]AAUjd=

Agent information:
   ID:001
   Name:ossec-client1
   IP Address:2.3.4.5

Confirm adding it?(y/n): y
Added.
** Press ENTER to return to the main menu.
</code></pre>

<p>Check if this in the <code>/var/ossec/etc/ossec.conf</code> file:</p>

<pre><code>&lt;client&gt;
  &lt;server-hostname&gt;1.2.3.4&lt;/server-hostname&gt;
&lt;/client&gt;
</code></pre>

<p>Where <code>1.2.3.4</code> is your OSSEC server URL or IP.</p>

<p>Now restart OSSEC on both the OSSEC server and the newly added client:</p>

<pre><code>/var/ossec/bin/ossec-control restart
</code></pre>

<p>Repeat these steps for any client that needs to be added. </p>

<h3>Bonus Tips</h3>

<p>Here are a few bonus tips/config examples for OSSEC</p>

<h3>Active Response</h3>

<p>If you&#39;ve enabled Active Response you are protected from brute force attacks for ssh and some other pieces of software. Try it, login as a nonexistent user and check the web ui and logging:</p>

<p><a href="https://raymii.org/s/inc/img/ossec/webui-brute-2.8.png"><img src="https://raymii.org/s/inc/img/ossec/webui-brute-2.8.png" width="320" height="240" alt="brute" /></a></p>

<pre><code>tail -f /var/ossec/logs/active-responses.log 
Wed Jun 11 21:16:43 CEST 2014 /var/ossec/active-response/bin/host-deny.sh add - 198.211.118.121 1402514203.20760 5712
Wed Jun 11 21:16:43 CEST 2014 /var/ossec/active-response/bin/firewall-drop.sh add - 198.211.118.121 1402514203.20760 5712
</code></pre>

<p>On Linux it is just a standard iptables DROP rule for that IP. You can delete the DROP rule by first finding out it&#39;s ID:</p>

<pre><code>iptables -L -n --line-numbers
Chain INPUT (policy ACCEPT)
num  target     prot opt source               destination         
1    DROP       all  --  198.211.118.121      0.0.0.0/0           

Chain FORWARD (policy ACCEPT)
num  target     prot opt source               destination         
1    DROP       all  --  198.211.118.121      0.0.0.0/0           

Chain OUTPUT (policy ACCEPT)
num  target     prot opt source               destination
</code></pre>

<p>Then you can delete the rule with that ID:</p>

<pre><code>iptables -D INPUT 1
iptables -D FORWARD 1
</code></pre>

<h4>Ignoring rules</h4>

<p>To very simply ignore rules based on rule id, add them to the XML file located in <code>/var/ossec/rules/local_rules/xml</code>, either on the ossec client for one machine or the ossec server to ignore on all machines:</p>

<pre><code>&lt;!-- Specify here a list of rules to ignore. --&gt;
&lt;!-- 3334 postfix start  --&gt;
&lt;!-- 3333 postfix stop --&gt;
&lt;rule id=&quot;100030&quot; level=&quot;0&quot;&gt;
    &lt;if_sid&gt;3333, 3334&lt;/if_sid&gt;
    &lt;description&gt;List of rules to be ignored.&lt;/description&gt;
&lt;/rule&gt;
</code></pre>

<h4>Monitoring additional log files</h4>

<p>The OSSEC agent by default only monitors a few log files. To add more, edit the <code>/var/ossec/etc/ossec.conf</code> file and add a line like this:</p>

<pre><code>&lt;localfile&gt;
    &lt;location&gt;/var/log/*&lt;/location&gt;
    &lt;log_format&gt;syslog&lt;/log_format&gt;
&lt;/localfile&gt;
</code></pre>

<p>This will add all files under <code>/var/log</code>. This might be a lot, you can also just add multiple <code>&lt;localfile&gt;</code> blocks with filenames.</p>

<h4>Firewall</h4>

<p>You need to allow UDP port 1514 between OSSEC server and clients. Otherwise you get errors like this:</p>

<pre><code>2013/09/06 19:53:00 ossec-agentd: INFO: Using IPv4 for: 10.0.51.31 .
2013/09/06 19:53:21 ossec-agentd(4101): WARN: Waiting for server reply (not started). Tried: &#39;ossec.raymii.nl/10.0.51.31&#39;.
</code></pre>

<h3>Removing OSSEC</h3>

<p><a href="https://raymii.org/s/tutorials/Uninstall_OSSEC.html">If you want to remove OSSEC, either the client or the server, read this tutorial. It covers all the steps required to uninstall OSSEC</a></p>
<hr>Tags: <a href="../tags/active-response.html" class="link">active-response, </a><a href="../tags/analogi.html" class="link">analogi, </a><a href="../tags/file-monitoring.html" class="link">file-monitoring, </a><a href="../tags/ids.html" class="link">ids, </a><a href="../tags/integrity.html" class="link">integrity, </a><a href="../tags/intrusion-detection.html" class="link">intrusion-detection, </a><a href="../tags/monitoring.html" class="link">monitoring, </a><a href="../tags/ossec.html" class="link">ossec, </a><a href="../tags/ossec-wui.html" class="link">ossec-wui, </a><a href="../tags/rootkit.html" class="link">rootkit, </a><a href="../tags/security.html" class="link">security, </a><a href="../tags/syslog.html" class="link">syslog, </a><div class="footer">
                <hr>
                <p>Generated by <a href="/s/software/ingsoc.html">ingsoc</a> | 
                <a href="/s/software/Sparkling_Network.html">Cluster Status</a> | 
                <a href="/s/static/About.html">About</a><br />
                </div>
            </div>
        </div>
    </div>  
    </div>
    </div>
     
    <!-- Piwik --> 
    <script type="text/javascript">
    var pkBaseURL = (("https:" == document.location.protocol) ? "https://hosted-oswa.org/piwik/" : "http://hosted-oswa.org/piwik/");
    document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
    </script><script type="text/javascript">
    try {
    var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 1);
    piwikTracker.trackPageView();
    piwikTracker.enableLinkTracking();
    } catch( err ) {}
    </script><noscript><p><img src="http://hosted-oswa.org/piwik/piwik.php?idsite=1" style="border:0" alt="" /></p></noscript>
    <!-- End Piwik Tracking Code -->
    </body>
    </html>
    