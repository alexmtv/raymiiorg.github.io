<!DOCTYPE html><html lang="en"><head><title>ntop-ng 1.1 installation on Ubuntu 12.04 - Raymii.org</title><link href="/s/inc/css/light.css" rel="stylesheet" title="light"/><link href="/s/inc/css/dark.css" rel="alternate stylesheet" title="dark"/><script async="" src="/s/inc/js/jquery-2.1.1.min.js"></script><script async="" src="/s/inc/js/bootstrap.3.2.0.min.js"></script><script async="" src="/s/inc/js/styleswitcher.js"></script><meta content="text/html;charset=utf-8" http-equiv="Content-Type"/><link href="inc/img/icons/iphone.png" rel="apple-touch-icon"/><link href="inc/img/icons/ipad.png" rel="apple-touch-icon" sizes="76x76"/><link href="inc/img/icons/iphone-retina.png" rel="apple-touch-icon" sizes="120x120"/><link href="inc/img/icons/ipad-retina.png" rel="apple-touch-icon" sizes="152x152"/><meta content="yes" name="apple-mobile-web-app-capable"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><link href="/s/inc/opensearch.xml" rel="search" type="application/opensearchdescription+xml"/><link href="https://raymii.org/s/feed.xml" rel="alternate" title="RSS Feed for Raymii.org" type="application/rss+xml"/></head><body><a id="top-of-page"></a><div class="container-fluid "><div class="row"><div class="col-md-12"><div class="col-md-3 col-sm-3 max-200"><div class="well well-none"><h3 class="headheader"><a href="https://raymii.org/s/">Raymii.org<img alt="IEC Resistor logo" src="https://raymii.org/s/inc/img/resistor-50.png"/></a></h3><h6 class="headheader">Quis custodiet ipsos custodes?</h6><h6><a href="https://raymii.org/s/feed.xml">RSS Feed</a></h6></div><form action="https://encrypted.google.com/search" role="search"><div class="form-group"><input name="as_sitesearch" type="hidden" value="raymii.org"/><input name="as_qdr" type="hidden" value="all"/><input class="form-control" name="as_q" placeholder="Search" type="text"/></div></form><div class="menu"><ul class="nav nav-pills nav-stacked"><li><a class="special-menu" href="/s/index.html">Home</a></li><li class="bottom-spacing"><a class="special-menu" href="/s/everything.html">All Items</a></li><li><a class="link" href="/s/tags/bash.html">Bash</a></li><li><a class="link" href="/s/tags/monitoring.html">Monitoring</a></li><li><a class="link" href="/s/tags/ssl.html">SSL</a></li><li><a class="link" href="/s/tags/debian.html">Debian</a></li><li><a class="link" href="/s/tags/python.html">Python</a></li><li><a class="link" href="/s/tags/vpn.html">VPN</a></li><li><a class="link" href="/s/tags/ubuntu.html">Ubuntu</a></li><li><a class="link" href="/s/tags/nginx.html">nginx</a></li><li><a class="link" href="/s/tags/openstack.html">Openstack</a></li><li><a class="link" href="/s/tags/ansible.html">Ansible</a></li></ul><ul class="navbar-collapse nav navbar-nav"><li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Style<b class="caret"></b></a><ul class="dropdown-menu"><li><a href="#" onclick="setActiveStyleSheet('dark')">Dark</a></li><li><a href="#" onclick="setActiveStyleSheet('light')">Light</a></li></ul></li></ul><br/><br/><a href="http://clients.inceptionhosting.com/aff.php?aff=083">Inception Hosting Affiliate Link</a><br/> <a href="https://www.digitalocean.com/?refcode=7435ae6b8212">Digital Ocean Affiliate Link, $10 free credit.</a><br/><script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" data-ad-client="ca-pub-7993642564731324" data-ad-slot="9322003332" style="display:inline-block;width:200px;height:200px"></ins><script>
                (adsbygoogle = window.adsbygoogle || []).push({});
                </script></div></div><div class="col-md-8 col-sm-8"><div class="inner"><h2 class="headheader">ntop-ng 1.1 installation on Ubuntu 12.04</h2><ul class="breadcrumb"><li><a class="link" href="../index.html">Home</a></li><li><a class="link" href="../tutorials/index.html">Tutorials</a></li><li><a class="link" href="ntop-ng-installation-on-Ubuntu.html">ntop-ng 1.1 installation on Ubuntu 12.04</a></li></ul><p><small>29-11-2013</small> | <small>Remy van Elst</small></p><div class="ad"><script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle" data-ad-client="ca-pub-7993642564731324" data-ad-slot="6172324376" style="display:inline-block;width:728px;height:90px"></ins><script>
                            (adsbygoogle = window.adsbygoogle || []).push({});
                            </script></div><br/><h3>Screenshots</h3><p><a href="https://raymii.org/s/inc/img/ntopng/1.png"><img alt="ntop" src="https://raymii.org/s/inc/img/ntopng/1.png"/></a></p><p><a href="https://raymii.org/s/inc/img/ntopng/2.png"><img alt="ntop" src="https://raymii.org/s/inc/img/ntopng/2.png"/></a></p><p><a href="https://raymii.org/s/inc/img/ntopng/3.png"><img alt="ntop" src="https://raymii.org/s/inc/img/ntopng/3.png"/></a></p><p><a href="https://raymii.org/s/inc/img/ntopng/4.png"><img alt="ntop" src="https://raymii.org/s/inc/img/ntopng/4.png"/></a></p><p><a href="https://raymii.org/s/inc/img/ntopng/5.png"><img alt="ntop" src="https://raymii.org/s/inc/img/ntopng/5.png"/></a></p><p>This is a guide on installing the latest ntop-ng (1.1) on Ubuntu 12.04.</p><pre><code>ntopng is the next generation version of the original ntop, a network traffic probe that shows the network usage, similar to what the popular top Unix command does. ntop is based on libpcap and it has been written in a portable way in order to virtually run on every Unix platform, MacOSX and on Win32 as well. ntopng users can use a a web browser to navigate through ntop (that acts as a web server) traffic information and get a dump of the network status. In the latter case, ntop can be seen as a simple RMON-like agent with an embedded web interface. 
</code></pre><p>This tutorial will walk you through the compilation and installation of ntopng from source. The package in the Ubuntu 12.04 repositories it quite old.</p><h3>What can ntopng do?</h3><ul><li>Sort network traffic according to many protocols</li><li>Show network traffic and IPv4/v6 active hosts</li><li>Store on disk persistent traffic statistics in RRD format</li><li>Geolocate hosts</li><li>Discover application protocols by leveraging on nDPI, ntops DPI framework.</li><li>Characterise HTTP traffic by leveraging on characterisation services provided by block.si.</li><li>Show IP traffic distribution among the various protocols</li><li>Analyse IP traffic and sort it according to the source/destination</li><li>Display IP Traffic Subnet matrix (who is talking to who?)</li><li>Report IP protocol usage sorted by protocol type</li><li>Act as a NetFlow/sFlow collector for flows generated by routers (e.g. Cisco and Juniper) or switches (e.g. Foundry Networks) when used together with nProbe.</li><li>Produce HTML5/AJAX network traffic statistics</li></ul><p><a href="http://www.ntop.org/">More information on ntop-ng can be found on their website: http://www.ntop.org/</a></p><h3>Contents</h3><p>This is what we are going to do:</p><ul><li>Install required packages</li><li>Download files</li><li>Place ntopng-data</li><li>Compile ntopng</li><li>Create config file</li><li>Test ntopng</li><li>Place upstart script</li></ul><p>Here's what you need:</p><ul><li>Ubuntu 12.04 installation</li><li>Debian 7 also works</li></ul><p><a href="https://www.digitalocean.com/?refcode=7435ae6b8212">This tutorial was tested on a DigitalOcean VPS. If you use this link you sponsor this website. (referral link)</a></p><h3>Note about checkinstall and packages</h3><p>We are using checkinstall here to create a debian package of the source we compile. I do this because it gives more flexibility in managing the software afterwards. Upgrading or uninstalling the packages is easier than removing all the things make install placed. Furthermore, it makes it more clear for other administrators which software is installed.</p><p>If you for example want to upgrade ntop-ng when it was installed via this tutorial with checkinstall, repeat the tutorial with only the version number changed.</p><h3>Installing required packages</h3><p>These are the packages we need to build and use for ntopng</p><pre><code> apt-get install libpcap-dev libglib2.0-dev libgeoip-dev redis-server wget libxml2-dev build-essential checkinstall
</code></pre><h3>Download the files</h3><p>We need to download both the data files and the source code. You can download it <a href="http://sourceforge.net/projects/ntop/files/ntopng/">from sourceforge</a>:</p><pre><code>mkdir -p /usr/local/src
cd /usr/local/src

wget "http://downloads.sourceforge.net/project/ntop/ntopng/ntopng-data-1.1_6932.tgz" -O ntopng-data-1.1.tar.gz

wget "http://downloads.sourceforge.net/project/ntop/ntopng/ntopng-1.1_6932.tgz" -O ntopng-1.1.tar.gz
</code></pre><h3>Place ntopng-data</h3><p>The data files contain files for the web interface like the GeoIP database. They are already good, the only thing we need to do is place them:</p><pre><code>cd /usr/local/src
tar -xf ntopng-data-1.1.tar.gz
cd ntopng-data-1.1_6932
cp -r ./usr/* /usr 
</code></pre><h3>Compile ntopng</h3><p>The compilation of ntopng itself is a bit more work, this is because the ntopng 1.1 package includes prebuilt .o blobs for third party tools, probably by accident, which will cause you trouble when building ntopng yourself. We need to clean those up.</p><p>First we extract:</p><pre><code>cd /usr/local/src
tar -xf ntopng-1.1.tar.gz
cd ntopng-1.1_6932
</code></pre><p>Then we configure:</p><pre><code>./configure
</code></pre><p>Clean up:</p><pre><code>make clean

cd third-party/json-c 
make clean
cd .. 

cd third-party/LuaJIT-2.0.2
make clean
cd .. 

cd third-party/rrdtool-1.4.7
make clean
cd ..

cd third-party/zeromq-3.2.3
make clean
cd ..

cd third-party/credis-0.2.3
make clean
cd ..
</code></pre><p>Start the actual compilation:</p><pre><code>make
</code></pre><p>And install the thing:</p><pre><code>checkinstall
</code></pre><p>The default answers for checkinstall are okay.</p><h3>Creating the ntopng config file</h3><p>First we create the required folder:</p><pre><code>mkdir -p /etc/ntopng
</code></pre><p>There are two files needed. First is <code>/etc/ntopng/ntopng.start</code>:</p><pre><code>--local-networks "172.20.16.0/24"
--interface 1
</code></pre><p>To see all available interfaces and options, use the <code>ntopng -h</code> option:</p><pre><code>Available interfaces (-i &lt;interface index&gt;):
   1. eth0
   2. vmbr0
   3. venet0
   [...]
   14. any
   15. lo
</code></pre><p>Then there is the <code>/etc/ntopng/ntopng.conf</code> file:</p><pre><code>-G=/var/run/ntopng.pid
</code></pre><p>Again, with the <code>ntopng -</code> option you can see all the possible options for use in this config file.</p><p>Before starting the test, make sure redis is started:</p><pre><code>/etc/init.d/redis-server restart
</code></pre><h3>Test ntopng</h3><p>If the compilation gave no errors and the config files are places we can start <code>ntopng</code> and see how it works:</p><pre><code>ntopng /etc/ntopng/ntopng.conf
</code></pre><p>Use your web browser to navigate to <code>http://your-ntop-box-ip:3000</code>. There you can login with the username/password combo <code>admin/admin</code>.</p><p>If this works, and there is data visible as in the screenshots, continue on to set up the upstart script.</p><h3>Upstart script</h3><p>This is a simple upstart script which can be used to start, stop and restart ntopng. Place it in <code>/etc/init/ntopng.conf</code>:</p><pre><code># ntopng network flow analyzer
# by https://raymii.org

description     "ntopng network flow analyzer"

start on virtual-filesystems
stop on runlevel [06]

respawn
respawn limit 5 30
limit nofile 65550 65550

setuid root
setgid root
console log

script
        exec /usr/local/bin/ntopng /etc/ntopng/ntopng.conf
end script
</code></pre><hr/>Tags: <a class="link" href="../tags/apache.html">apache,</a><a class="link" href="../tags/lua.html">lua,</a><a class="link" href="../tags/monitoring.html">monitoring,</a><a class="link" href="../tags/network.html">network,</a><a class="link" href="../tags/ntop.html">ntop,</a><a class="link" href="../tags/ntop-ng.html">ntop-ng,</a><a class="link" href="../tags/ubuntu.html">ubuntu,</a><div class="footer"><hr/><p>Generated by <a href="/s/software/ingsoc.html">ingsoc</a> | <a href="/s/software/Sparkling_Network.html">Cluster Status</a> | <a href="/s/static/About.html">About</a><br/></p></div></div></div></div></div></div><script type="text/javascript">
    var pkBaseURL = (("https:" == document.location.protocol) ? "https://hosted-oswa.org/piwik/" : "http://hosted-oswa.org/piwik/");
    document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
    </script><script type="text/javascript">
    try {
    var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 1);
    piwikTracker.trackPageView();
    piwikTracker.enableLinkTracking();
    } catch( err ) {}
    </script><noscript>&lt;p&gt;&lt;img src="http://hosted-oswa.org/piwik/piwik.php?idsite=1" style="border:0" alt="" /&gt;&lt;/p&gt;</noscript></body></html>