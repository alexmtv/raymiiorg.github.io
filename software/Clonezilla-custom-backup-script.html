<!DOCTYPE html><html lang="en"><head><title>Clonezilla Backup Script v0.2 - Raymii.org</title><link href="/s/inc/css/bootstrap.css" rel="stylesheet"/><link href="/s/inc/css/custom.css" rel="stylesheet"/><meta content="text/html;charset=utf-8" http-equiv="Content-Type"/><meta content="IE=edge" http-equiv="X-UA-Compatible"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><link href="http://feeds.feedburner.com/Raymiiorg" rel="alternate" title="Raymii.org RSS" type="application/rss+xml"/></head><body><a id="top-of-page"></a> <div class="container-fluid "><div class="row"><div class="col-md-10 col-md-offset-1"><div class="col-md-3 well"> <h3 class="headheader"><a href="https://raymii.org/s/">Raymii.org</a></h3><h6>Quis custodiet ipsos custodes?</h6><h6><a href="http://feeds.feedburner.com/Raymiiorg">RSS Feed</a></h6></div><div class="col-md-4 green-block"><h3>Featured Items</h3><a class="whitelink" href="/s/tutorials/Ansible_Deployment_Framework.html">Ansible Deployment Framework</a> <br/><a class="whitelink" href="/s/tutorials/Pass_the_SSL_Labs_Test_on_Apache2_(Mitigate_the_CRIME_and_BEAST_attack_-_Disable_SSLv2_-_Enable_PFS).html">Pass the SSL Labs Test on Apache2 (Mitigate the CRIME and BEAST attack Disable SSLv2 Enable PFS)</a> <br/><a class="whitelink" href="/s/articles/Small_Linux_PCs.html">Small Linux PCs</a> <br/><a class="whitelink" href="/s/tutorials/VMWare-ESXi-5-USB-installer.html">VMWare ESXi 5 USB installer</a> <br/></div><div class="col-md-4 green-block"><h3>Featured Items</h3><a class="whitelink" href="/s/software/Bash_PHP_Server_Status_Monitor.html">Bash PHP Server Status Monitor</a> <br/><a class="whitelink" href="/s/tutorials/IPSEC_L2TP_vpn_with_Ubuntu_12.04.html">IPSEC L2TP vpn with Ubuntu 12.04</a> <br/><a class="whitelink" href="/s/software/Nopriv-IMAP-backup.html">Nopriv IMAP backup</a> <br/><a class="whitelink" href="/s/tutorials/Pass_the_SSL_Labs_Test_on_NGINX_(Mitigate_the_CRIME_and_BEAST_attack_-_Disable_SSLv2_-_Enable_PFS).html">Pass the SSL Labs Test on NGINX (Mitigate the CRIME and BEAST attack Disable SSLv2 Enable PFS)</a> <br/></div></div></div><div class="row-fluid"><div class="col-md-11 col-md-offset-1"><div class="col-md-3"><h3>Menu</h3><ul class="nav nav-pills nav-stacked"><li><a class="link" href="/s/">Home</a> </li><li><a class="link" href="/s/static/Contact.html">Contact</a> </li><li><a class="link" href="/s/static/Disclaimer.html">Disclaimer</a> </li><li><a class="link" href="/s/static/Hosted_Piwik.html">Hosted Piwik</a> </li><li><a class="link" href="/s/static/Sparkling_Network.html">Sparkling Network</a> </li><li><a class="link" href="/s/static/Terrible-Linux.html">Terrible Linux</a> </li></ul><h3>Categories</h3><ul class="nav nav-pills nav-stacked"><li><a class="link" href="/s/articles">Articles</a> </li><li><a class="link" href="/s/snippets">Snippets</a> </li><li><a class="link" href="/s/software">Software</a> </li><li><a class="link" href="/s/tutorials">Tutorials</a> </li><li><a class="link" href="/s/everything.html">All Items</a></li><a class="link" href="/s/everything.html"></a> </ul><hr class="alt2"/><h3>Donate</h3><a href="http://clients.inceptionhosting.com/aff.php?aff=083">Need a VPS server? InceptionHosting has excellent VPS servers located in the USA or NL!</a><p><script id="flattrbtn">(function(i){var f,s=document.getElementById(i);f=document.createElement('iframe');f.src='//api.flattr.com/button/view/?uid=Remy&url='+encodeURIComponent(document.URL);f.title='Flattr';f.height=62;f.width=55;f.style.borderWidth=0;s.parentNode.insertBefore(f,s);})('flattrbtn');</script><br/></p><form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top"><input name="cmd" type="hidden" value="_s-xclick"/><input name="encrypted" type="hidden" value="-----BEGIN PKCS7-----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-----END PKCS7-----"/><input alt="PayPal - The safer, easier way to pay online!" border="0" name="submit" src="https://www.paypalobjects.com/en_US/NL/i/btn/btn_donateCC_LG.gif" type="image"/><img alt="" border="0" height="1" src="https://www.paypalobjects.com/nl_NL/i/scr/pixel.gif" width="1"/></form><script type="text/javascript"><!--
                google_ad_client = "ca-pub-7993642564731324";
                /* Raymii-2 */
                google_ad_slot = "9322003332";
                google_ad_width = 200;
                google_ad_height = 200;
                //-->
                </script><script src="http://pagead2.googlesyndication.com/pagead/show_ads.js" type="text/javascript">
                </script></div> <div class="col-md-7"> <div class="inner"><h2>Clonezilla Backup Script v0.2</h2><ul class="breadcrumb"><li><a class="link" href="../">Home</a> <col-md- class="divider">/</col-md-></li><li><a class="link" href="../software">Software</a> <col-md- class="divider">/</col-md-></li><li><a class="link" href="Clonezilla-custom-backup-script.html">Clonezilla Backup Script v0.2</a> </li></ul><h6>Author: Remy Van Elst, David Bekker</h6><h6>Date: 18-05-2009</h6><br/><p>Clonezilla is wonderfull software. At work we use it daily to image laptops. We have a windows PC with a big hard drive, which is shared via samba.<br/>Because we image an average of 10 laptops every morning, I decided to customize the script. So together with a colleague we made a script which automatically grabs our latest image from the share and restores it.<br/>Our images are named schoon#.<br/>It restores the image to /dev/sda. But you can change the clonezilla command.<br/>Make sure your share is writable.<br/>It gets network from dhcp on eth0.<br/>So, the steps to get the script in clonezilla:</p><ul><li>Install the squashfs-tools for your distro, this is important.<br/></li><li>Unetbootin the ISO to a USB. </li><li>Copy the files to a dir on your pc and open a terminal in the dir. </li></ul><p>Then do this</p><pre><code> cd live
 sudo unsquashfs -f ./filesystem.squashfs 
</code></pre><p>Now make a dir in de squashfs-root. Put the scripts in there, change them or not, and chmod them so that they are executable. </p><p>Don't forget to change the path in the launcher script, else it won't work.<br/>Now make it back to a life system:</p><pre><code>sudo mksquashfs ./squashfs-root ./filesystem.squashfs.new
</code></pre><p>And change the syslinux.cfg so that the paths are correct if you changed them:</p><pre><code>label ubnentry0
menu label RESTORE
kernel /live/vmlinuz1
append initrd=/live/initrd1.img boot=live union=aufs  hostname=jaunty edd=on nolocales ocs_live_run="/laptop03/startr.sh" ocs_live_extra_param="" ocs_live_keymap="NONE" ocs_live_batch="no" ocs_lang="" noprompt mode_option=1024x768 toram=filesystem.squashfs ip=frommedia
</code></pre><p>Now, here are the scripts: backup-schoon.sh (this makes a backup image) </p><pre><code>#!/bin/bash
dhclient
clear
echo "################################"
echo "# Daniel Imager for Erasmus MC #"
echo "#      By Raymii & David       #"
echo "#     Based on Clonezilla      #"
echo "################################"
echo
echo
echo "Mounting the image share. If asked for a password, enter 1234"
echo
mount -t cifs -o username="administrator",password="emcdaniel" //192.168.1.2/image /home/partimag
echo
#clear
cd /home/partimag
echo "We zitten in map:"
pwd
echo ;
DIRS="$(ls -d */ | grep '')"
GROOTSTE_GETAL=0
# Met alle directories gaan we een voor een aan de slag 
for DIR in $DIRS;
do
# Stop de naam van de directory in RUWE_STRING
RUWE_STRING=$DIR
# Haal de slash aan het eind van RUWE_STRING af 
RUWE_STRING=${RUWE_STRING%/} 
# Haal aan het begin van RUWE_STRING "schoon" af. We houden nu het GEZOCHTE_GETAL over
GEZOCHTE_GETAL=${RUWE_STRING#schoon} 
# De volgende twee commando's zorgen er voor dat als GEZOCHTE_GETAL geen getal is
# deze de waarde 0 krijgt 
let GEZOCHTE_GETAL++
let GEZOCHTE_GETAL--
# Als GEZOCHTE_GETAL ongelijk is aan 0 dan gaan we er mee aan de gang
if (( $GEZOCHTE_GETAL > 0 )) 
then
# Als GEZOCHTE_GETAL groter is dan GROOTSTE_GETAL
# dan wordt GROOTSTE_GETAL gelijk gemaakt aan GEZOCHTE_GETAL
if (( $GEZOCHTE_GETAL > $GROOTSTE_GETAL )) 
then
GROOTSTE_GETAL=$GEZOCHTE_GETAL 
fi
#    echo "I: $I  J: $GEZOCHTE_GETAL"
fi
done

# Als GROOTSTE_GETAL groter is dan nul is er een schone backup aanwezig en 
# hogen we GROOTSTE_GETAL met een op maken we een nieuwe schone backup: schoon(GROOTSTE_GETAL+1)
# Zo niet dan nieuwe schone backup: schoon01
if (( $GROOTSTE_GETAL > 0 ))
then
let GROOTSTE_GETAL++
echo "Starting latest backup: schoon$GROOTSTE_GETAL"
NAME="schoon$GROOTSTE_GETAL"
/opt/drbl/sbin/ocs-sr -q -j2 -z1p -i 3900 -p true savedisk "$NAME" "sda"
else
echo "No backups found, making a new one: schoon01"
/opt/drbl/sbin/ocs-sr -q -j2 -z1p -i 3900 -p true savedisk "schoon11" "sda"
fi
</code></pre><p>restore-schoon.sh (this restores the image) </p><pre><code> #!/bin/bash
dhclient
clear
echo "################################"
echo "# Daniel Imager for Erasmus MC #"
echo "#      By Raymii & David       #"
echo "#     Based on Clonezilla      #"
echo "#       Made on 01-04-10       #"
echo "################################"
echo
echo
echo "Mounting the image share. If asked for a password, enter 1234"
echo
mount -t cifs -o username="administrator",password="emcdaniel" //192.168.1.2/image /home/partimag
#clear
cd /home/partimag
echo "We zitten in map:"
pwd
echo ;
DIRS="$(ls -d */ | grep '')"
GROOTSTE_GETAL=0
# Met alle directories gaan we een voor een aan de slag 
for DIR in $DIRS;
do
# Stop de naam van de directory in RUWE_STRING
RUWE_STRING=$DIR
# Haal de slash aan het eind van RUWE_STRING af 
RUWE_STRING=${RUWE_STRING%/} 
# Haal aan het begin van RUWE_STRING "schoon" af. We houden nu het GEZOCHTE_GETAL over
GEZOCHTE_GETAL=${RUWE_STRING#schoon} 
# De volgende twee commando's zorgen er voor dat als GEZOCHTE_GETAL geen getal is
# deze de waarde 0 krijgt 
let GEZOCHTE_GETAL++
let GEZOCHTE_GETAL--
# Als GEZOCHTE_GETAL ongelijk is aan 0 dan gaan we er mee aan de gang
if (( $GEZOCHTE_GETAL > 0 )) 
then
# Als GEZOCHTE_GETAL groter is dan GROOTSTE_GETAL
# dan wordt GROOTSTE_GETAL gelijk gemaakt aan GEZOCHTE_GETAL
if (( $GEZOCHTE_GETAL > $GROOTSTE_GETAL )) 
then
GROOTSTE_GETAL=$GEZOCHTE_GETAL 
fi
fi
done

# Als GROOTSTE_GETAL groter is dan nul is er een schone backup aanwezig en 
# kunnen we met de restore beginnen. Zo niet dan geven we de error terug
if (( $GROOTSTE_GETAL > 0 ))
then
echo "Start met restore van schoon$GROOTSTE_GETAL"
NAME="schoon$GROOTSTE_GETAL"
/opt/drbl/sbin/ocs-sr -g auto -e1  auto -e2 -j2 -p true restoredisk "$NAME" "sda"
else
echo "Er is geen schone restore aanwezig."
echo "Controleer of de server aanstaat en of de share aanwezig is. Maak anders een nieuw image."
echo "Selecteer dadelijk de optie Start Over."
fi
</code></pre><p>start.sh (bootstrapper for backup script) </p><pre><code> #!/bin/sh
 sudo su -c /laptop03/backup-schoon.sh
</code></pre><p>startr.sh (bootstrapper for restore script) </p><pre><code> #!/bin/sh
 sudo su -c /laptop03/restore-schoon.sh
</code></pre><p>Note that this is all on your own risk, no warranty or purpose for any target and all the regular bla-bla. </p><p>Good luck with the scripts and clonezilla! </p><hr/>Tags: <a class="link" href="../tags/backup.html">backup, </a> <a class="link" href="../tags/clonezilla.html">clonezilla, </a> <a class="link" href="../tags/imaging.html">imaging, </a> <a class="link" href="../tags/squashfs.html">squashfs, </a> <div class="footer"><hr/><br/><hr/><p>Generated by <a href="https://raymii.org/s/software/ingsoc.html">ingsoc</a>.<br/></p></div></div></div></div> </div></div><script type="text/javascript">
    var pkBaseURL = (("https:" == document.location.protocol) ? "https://hosted-oswa.org/piwik/" : "http://hosted-oswa.org/piwik/");
    document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
    </script><script type="text/javascript">
    try {
    var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 1);
    piwikTracker.trackPageView();
    piwikTracker.enableLinkTracking();
    } catch( err ) {}
    </script><noscript>&amp;lt;p&amp;gt;&amp;lt;img src="http://hosted-oswa.org/piwik/piwik.php?idsite=1" style="border:0" alt="" /&amp;gt;&amp;lt;/p&amp;gt;</noscript><script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script><script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-3704876-6");
    pageTracker._trackPageview();
    } catch(err) {}</script></body></html>