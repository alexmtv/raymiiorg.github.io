
    <!DOCTYPE html>
    <html lang="en">
        <head>
        <title>Nagios plugin to check an OCSP server - Raymii.org</title>
        <link href="/s/inc/css/bootstrap.css" rel="stylesheet" />
        <link href="/s/inc/css/custom.css" rel="stylesheet" />
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <link href="inc/img/icons/iphone.png" rel="apple-touch-icon" />
        <link href="inc/img/icons/ipad.png" rel="apple-touch-icon" sizes="76x76" />
        <link href="inc/img/icons/iphone-retina.png" rel="apple-touch-icon" sizes="120x120" />
        <link href="inc/img/icons/ipad-retina.png" rel="apple-touch-icon" sizes="152x152" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="alternate" type="application/rss+xml" title="RSS Feed for Raymii.org" href="http://feeds.feedburner.com/Raymiiorg" />
    </head>
    <body>
        <a id="top-of-page"></a>
        <div class="container-fluid ">
        <div class="row">
        <div class="col-md-10 col-md-offset-1">
            <div class="col-md-3 well"> 
                <h3 class="headheader"><a href="https://raymii.org/s/">Raymii.org</a></h3>
                <h6>Quis custodiet ipsos custodes?</h6>
                <h6><a href="http://feeds.feedburner.com/Raymiiorg">RSS Feed</a></h6>
            </div>
            <div class="col-md-4 green-block">
                    <h3>Featured Items</h3>
    <a href="/s/tutorials/Ansible_Deployment_Framework.html" class="whitelink">Ansible Deployment Framework</a><br /><a href="/s/articles/Digital_Ocean_Sucks._Use_Digital_Ocean.html" class="whitelink">Digital Ocean Sucks. Use Digital Ocean</a><br /><a href="/s/tutorials/Gitlab_and_Active_Directory_LDAP_Authentication.html" class="whitelink">Gitlab and Active Directory LDAP Authentication</a><br /><a href="/s/articles/Small_Linux_PCs.html" class="whitelink">Small Linux PCs</a><br /><a href="/s/tutorials/Strong_SSL_Security_On_Apache2.html" class="whitelink">Strong SSL Security On Apache2</a><br /><a href="/s/tutorials/VMWare-ESXi-5-USB-installer.html" class="whitelink">VMWare ESXi 5 USB installer</a><br />
        </div>
        <div class="col-md-4 green-block">
                <h3>Featured Items</h3>
    <a href="/s/software/Bash_PHP_Server_Status_Monitor.html" class="whitelink">Bash PHP Server Status Monitor</a><br /><a href="/s/tutorials/IPSEC_L2TP_vpn_with_Ubuntu_12.04.html" class="whitelink">IPSEC L2TP vpn with Ubuntu 12.04</a><br /><a href="/s/software/Nopriv-IMAP-backup.html" class="whitelink">Nopriv IMAP backup</a><br /><a href="/s/articles/Set_up_your_own_truly_secure_encrypted_shared_storage_aka_Dropbox_clone.html" class="whitelink">Set up your own truly secure encrypted shared storage aka Dropbox clone</a><br /><a href="/s/tutorials/Strong_SSL_Security_On_nginx.html" class="whitelink">Strong SSL Security On nginx</a><br />
            
        </div>
    </div>
    
    </div>
    <div class="row-fluid">
    <div class="col-md-11 col-md-offset-1">
    

    <div class="col-md-3">
    <h3>Menu</h3><ul class="nav nav-pills nav-stacked"><li><a href="/s/" class="link">Home</a></li><li><a href="/s/static/Contact.html" class="link">Contact</a></li><li><a href="/s/static/Disclaimer.html" class="link">Disclaimer</a></li><li><a href="/s/static/Hosted_Piwik.html" class="link">Hosted Piwik</a></li><li><a href="/s/static/Sparkling_Network.html" class="link">Sparkling Network</a></li></ul><h3>Categories</h3><ul class="nav nav-pills nav-stacked"><li><a href="/s/articles" class="link">Articles</a></li><li><a href="/s/snippets" class="link">Snippets</a></li><li><a href="/s/software" class="link">Software</a></li><li><a href="/s/tutorials" class="link">Tutorials</a></li><li><a href="/s/everything.html" class="link">All Items</a></li></ul>
               <!-- advertisement start -->
                <hr class="alt2">
                <h3>Donate</h3>
                <ul><li><a href="http://clients.inceptionhosting.com/aff.php?aff=083">Inception Hosting VPS Affiliate Link</a></li>
                <li><a href="https://www.digitalocean.com/?refcode=7435ae6b8212">Digital Ocean VPS Affiliate</a></li></ul>
                <script id='flattrbtn'>(function(i){var f,s=document.getElementById(i);f=document.createElement('iframe');f.src='//api.flattr.com/button/view/?uid=Remy&url='+encodeURIComponent(document.URL);f.title='Flattr';f.height=62;f.width=55;f.style.borderWidth=0;s.parentNode.insertBefore(f,s);})('flattrbtn');</script><br />
                <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
                <input type="hidden" name="cmd" value="_s-xclick">
                <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----
                ">
                <input type="image" src="https://www.paypalobjects.com/en_US/NL/i/btn/btn_donateCC_LG.gif" name="submit" alt="PayPal - The safer, easier way to pay online!">
                <img alt="" src="https://www.paypalobjects.com/nl_NL/i/scr/pixel.gif" width="1" height="1">
                </form>
                <script type="text/javascript"><!--
                google_ad_client = "ca-pub-7993642564731324";
                google_ad_slot = "9322003332";
                google_ad_width = 200;
                google_ad_height = 200;
                //-->
                </script>
                <script type="text/javascript"
                src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
                </script>    
                <!-- advertisement end -->

           </div>  
           <div class="col-md-7"> 
                <div class="inner">


           <h2>Nagios plugin to check an OCSP server</h2><ul class="breadcrumb"><li><a href="../" class="link">Home</a></li><li><a href="../software" class="link">Software</a></li><li><a href="Nagios_plugin_to_check_OCSP.html" class="link">Nagios plugin to check an OCSP server</a></li></ul><h6>Author: Remy Van Elst</h6><h6>Date: 06-05-2013</h6><br><p>This is a nagios plugin to check an OCSP server. It does so by having either a PEM encoded certificate in the code, and the PEM encoded certificate of the issuer in the code, or by using two given PEM files. This is sent to the OCSP server and the response is then parsed to give the correct nagios result. It is targeted at administrators who have their own OCSP and need to know when it is not working. </p>

<p>This version has contributions from <a href="https://github.com/palli/">Pali Sigurdsson</a>.</p>

<p><a href="http://clients.inceptionhosting.com/aff.php?aff=083">Do you need a VPS for hosting nagios? InceptionHosting has very good VPS servers!</a></p>

<h4>Download</h4>

<p><a href="https://github.com/RaymiiOrg/nagios">Download the plugin from my github</a><br>
<a href="https://raymii.org/s/inc/downloads/check_ocsp.sh">Download the plugin from raymii.org</a>  </p>

<h4>Usage</h4>

<p><code>./check_ocsp.sh</code>:</p>

<ul>
<li><code>-H host_name</code> - remote host to check</li>
<li><code>-P port</code> - port to use</li>
<li><code>--noverify</code> - Don&#39;t verify if certificate is valid</li>
<li><code>--max-age 4800</code> - alert if certificate is about to expire</li>
<li><code>--cert filename</code> - use this cert file instead of the hardcoded one</li>
<li><code>--issuer filename.pem</code> - use this issuer certificate instead of the hardcoded one</li>
<li><code>--verbose</code> - handy for troubleshooting, echos the exact openssl command used</li>
</ul>

<h4>Installation</h4>

<p>This guide covers the steps needed for Ubuntu 10.04/12.04 and Debian 6. It should also work on other distro&#39;s, but make sure to modify the commands where needed (package installation for example).</p>

<p>First make sure you have the required tools:</p>

<pre><code>apt-get install gawk grep bash sed wget curl openssl
</code></pre>

<p>Place the script on the nagios host (I&#39;ve placed it in <em>/etc/nagios/plugins/</em>):</p>

<pre><code>wget -O */etc/nagios/plugins/check_ocsp_hard.sh http://raymii.org/s/inc/downloads/check_ocsp_hard.sh
</code></pre>

<p>Make sure that the script is executable:</p>

<pre><code>chmod +x /etc/nagios/plugins/check_ocsp_hard.sh
</code></pre>

<p>Now test it:</p>

<pre><code>/etc/nagios/plugins/check_ocsp_hard.sh
OK: OCSP up and running - status of certificate for raymii.org GOOD by OCSP: http://ocsp.comodoca.com/
</code></pre>

<h4>Nagios config</h4>

<p>Here&#39;s some example nagios config:</p>

<p>Lets create a command definition:</p>

<pre><code>define command{
    command_name    check_ocsp
    command_line    /etc/nagios-plugins/check_ocsp.sh -H $USER1$ -p $USER2$ --cert $USER3$ --issuer $USER4$
}
</code></pre>

<p>And a service check:</p>

<pre><code>define service {
        use                             generic-service
        host_name                       localhost
        service_description             OCSP check of $OCSP for $DOMAIN
        contact                         nagiosadmin                 
        check_command                   check_ocsp!raymii.org!443!/etc/ssl/certs/raymiiorg.pem!/etc/ssl/certs/comodo.pem
}
</code></pre>

<p>Or if you use a hardcoded certificate:</p>

<pre><code>define command{
    command_name    check_ocsp_hard
    command_line    /etc/nagios-plugins/check_ocsp.sh
}

define service {
        use                             generic-service
        host_name                       localhost
        service_description             OCSP check of $OCSP for $DOMAIN with hardcoded certificate
        contact                         nagiosadmin                 
        check_command                   check_ocsp_hard
}
</code></pre>
<hr>Tags: <a href="../tags/certificates.html" class="link">certificates, </a><a href="../tags/dogtag.html" class="link">dogtag, </a><a href="../tags/monitoring.html" class="link">monitoring, </a><a href="../tags/nagios.html" class="link">nagios, </a><a href="../tags/ocsp.html" class="link">ocsp, </a><a href="../tags/openssl.html" class="link">openssl, </a><a href="../tags/ssl.html" class="link">ssl, </a><div class="footer">
                <hr />
                <br />
        
                <hr>
                <p>Generated by <a href="https://raymii.org/s/software/ingsoc.html">ingsoc</a>.<br />
                </div>
            </div>
        </div>
    </div>  
    </div>
    </div>
     
    <!-- Piwik --> 
    <script type="text/javascript">
    var pkBaseURL = (("https:" == document.location.protocol) ? "https://hosted-oswa.org/piwik/" : "http://hosted-oswa.org/piwik/");
    document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
    </script><script type="text/javascript">
    try {
    var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 1);
    piwikTracker.trackPageView();
    piwikTracker.enableLinkTracking();
    } catch( err ) {}
    </script><noscript><p><img src="http://hosted-oswa.org/piwik/piwik.php?idsite=1" style="border:0" alt="" /></p></noscript>
    <!-- End Piwik Tracking Code -->
    </body>
    </html>
    